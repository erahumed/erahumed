<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Changelog • erahumed</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Changelog"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">erahumed</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.3.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/erahumed/erahumed/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-news">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Changelog</h1>
      <small>Source: <a href="https://github.com/erahumed/erahumed/blob/master/NEWS.md" class="external-link"><code>NEWS.md</code></a></small>
    </div>

    <div class="section level2">
<h2 class="pkg-version" data-toc-text="development version" id="erahumed-development-version">erahumed (development version)<a class="anchor" aria-label="anchor" href="#erahumed-development-version"></a></h2>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.7.3" id="erahumed-073">erahumed 0.7.3<a class="anchor" aria-label="anchor" href="#erahumed-073"></a></h2>
<div class="section level4">
<h4 id="algorithm-changes-0-7-3">Algorithm changes<a class="anchor" aria-label="anchor" href="#algorithm-changes-0-7-3"></a></h4>
<ul><li>CT: the multiplier for the sediment to water diffusion term was thresholded to one, as this number should always be a positive fraction of unity. In any case, multipliers larger than one are probably being created by issues in the pesticide parameters (<em>e.g.</em> unit errors) that are currently being addressed, so that the threshold should become unnecessary in the long run.</li>
</ul></div>
<div class="section level4">
<h4 id="breaking-changes-0-7-3">Breaking changes<a class="anchor" aria-label="anchor" href="#breaking-changes-0-7-3"></a></h4>
<ul><li>Renamed arguments of <code><a href="../reference/ct.html">compute_ct()</a></code> by making units explicit (<em>e.g.</em> <code>css</code> becomes <code>css_ppm</code>).</li>
</ul></div>
<div class="section level4">
<h4 id="bug-fixes-0-7-3">Bug fixes<a class="anchor" aria-label="anchor" href="#bug-fixes-0-7-3"></a></h4>
<ul><li>Fixed inhomogeneous term in the evolution equation for <code>ms[t]</code> (due to a typo ms was wrongly getting added the mass applied on foliage).</li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-7-3">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-7-3"></a></h4>
<ul><li><p>Re-enabled tests that were momentarily disabled after the refactor of v0.6.0. These consisted of a few tests on the argument checking performed by <code><a href="../reference/hbp.html">compute_hbp()</a></code>, plus a snapshot test (skipped on CI) on the initial Shiny values.</p></li>
<li><p>Various simplifications in the low-level code of the CT model components.</p></li>
<li><p>Basic unit tests for the CT component functions.</p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.7.2" id="erahumed-072">erahumed 0.7.2<a class="anchor" aria-label="anchor" href="#erahumed-072"></a></h2>
<div class="section level4">
<h4 id="new-features-0-7-2">New features<a class="anchor" aria-label="anchor" href="#new-features-0-7-2"></a></h4>
<ul><li>CT model component now uses actual cluster and chemical parameters in the evolution equations (whereas it was previously using dummy values of the expected order of magnitude).</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.7.1" id="erahumed-071">erahumed 0.7.1<a class="anchor" aria-label="anchor" href="#erahumed-071"></a></h2>
<div class="section level4">
<h4 id="bug-fixes-0-7-1">Bug fixes<a class="anchor" aria-label="anchor" href="#bug-fixes-0-7-1"></a></h4>
<ul><li>Fixes a regression introduced in v0.7.0 that introduced an error in the computation of rain and evaporation water volumes (see <a href="https://github.com/erahumed/erahumed/issues/115" class="external-link">#115</a> and <a href="https://github.com/erahumed/erahumed/issues/116" class="external-link">#116</a>).</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.7.0" id="erahumed-070">erahumed 0.7.0<a class="anchor" aria-label="anchor" href="#erahumed-070"></a></h2>
<div class="section level4">
<h4 id="new-features-0-7-0">New features<a class="anchor" aria-label="anchor" href="#new-features-0-7-0"></a></h4>
<ul><li>Experimental release of CT model component, with new functions <code><a href="../reference/ct.html">compute_ct()</a></code> and <code><a href="../reference/ct.html">ct()</a></code> (close <a href="https://github.com/erahumed/erahumed/issues/92" class="external-link">#92</a>).</li>
</ul></div>
<div class="section level4">
<h4 id="breaking-changes-0-7-0">Breaking changes<a class="anchor" aria-label="anchor" href="#breaking-changes-0-7-0"></a></h4>
<ul><li><p>Removed helpers <code>linear_petp_surface()</code> and <code>linear_storage_curve()</code>. These were substituted by simple lambdas in the specification of defaults arguments of <code><a href="../reference/hba.html">compute_hba()</a></code>, which seems to be a bit more transparent (<a href="https://github.com/erahumed/erahumed/issues/96" class="external-link">#96</a>).</p></li>
<li><p><code><a href="../reference/hba.html">compute_hba()</a></code> argument name change: <code>petp_surface</code> becomes <code>petp_function</code>.</p></li>
</ul></div>
<div class="section level4">
<h4 id="improvements-0-7-0">Improvements<a class="anchor" aria-label="anchor" href="#improvements-0-7-0"></a></h4>
<ul><li>Set amounts (kg_per_ha) in albufera_ca_schedules builtin dataset (close <a href="https://github.com/erahumed/erahumed/issues/84" class="external-link">#84</a>).</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.6.0" id="erahumed-060">erahumed 0.6.0<a class="anchor" aria-label="anchor" href="#erahumed-060"></a></h2>
<div class="section level4">
<h4 id="general-info-0-6-0">General info<a class="anchor" aria-label="anchor" href="#general-info-0-6-0"></a></h4>
<p>This version provides an important refactor of the software’s modeling interface, consolidating the concept of ERAHUMED model and model components.</p>
<p>The refactor necessarily breaks existing code that relied on the initial provisional interface. A basic example illustrating how to use the new modeling interface is provided by the README update that accompanies the new version.</p>
</div>
<div class="section level4">
<h4 id="breaking-changes-0-6-0">Breaking changes<a class="anchor" aria-label="anchor" href="#breaking-changes-0-6-0"></a></h4>
<ul><li>Essential refactor of modeling API, as mentioned above.</li>
<li>The HBP model component (formerly known as “local hydrological balance”) does not allow anymore the specification of <code>date_min/max</code> arguments; the date range is univocally determined by the data fed to the INP model component.</li>
<li>Removed bold from printing methods, which was not correctly rendering in Github flavored markdown.</li>
<li>Renamed the HBP admissible plot types (value of <code>type</code> parameter to <code><a href="../reference/plot.erahumed_hbp.html">plot.erahumed_hbp()</a></code>), from <code>"cluster_levels"</code> and <code>"map"</code> to <code>"cluster_view"</code> and <code>"map_view"</code>.</li>
<li>Removed <code>height_thresh_cm</code> argument from arguments of CA component high level functions (<code><a href="../reference/ca.html">compute_ca()</a></code> in the present version), to move it down to the<br>
corresponding functions of the HBP component. This ensures, in particular, that a common value is used across the two different model components.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.5.1" id="erahumed-051">erahumed 0.5.1<a class="anchor" aria-label="anchor" href="#erahumed-051"></a></h2>
<div class="section level4">
<h4 id="documentation-0-5-1">Documentation<a class="anchor" aria-label="anchor" href="#documentation-0-5-1"></a></h4>
<ul><li>Emails and ORCID of additional package authors were added to the package metadata.</li>
</ul></div>
<div class="section level4">
<h4 id="bug-fixes-0-5-1">Bug fixes<a class="anchor" aria-label="anchor" href="#bug-fixes-0-5-1"></a></h4>
<ul><li>Fix bug that was causing errors in the plots of Perellonet, Perelló and Pujol outflows in the Shiny interface (<a href="https://github.com/erahumed/erahumed/issues/90" class="external-link">#90</a>).</li>
</ul></div>
<div class="section level4">
<h4 id="other-0-5-1">Other<a class="anchor" aria-label="anchor" href="#other-0-5-1"></a></h4>
<ul><li>The package has a new website, available at <a href="https://erahumed.github.io/erahumed/" class="uri">https://erahumed.github.io/erahumed/</a>.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.5.0" id="erahumed-050">erahumed 0.5.0<a class="anchor" aria-label="anchor" href="#erahumed-050"></a></h2>
<div class="section level4">
<h4 id="breaking-changes-0-5-0">Breaking changes<a class="anchor" aria-label="anchor" href="#breaking-changes-0-5-0"></a></h4>
<ul><li><p>Names of columns representing outflows in <code>albufera_outflows</code> have been prepended with <code>outflow_</code>.</p></li>
<li><p>Logic of <code>albufera_hb_global()</code> has been improved in such a way that the outflow columns are automatically recognized from the input data.frame, and do not need to be exactly <code>"pujol"</code>, <code>"perellonet"</code> and `<code>"perello"</code>, as before.</p></li>
<li><p>Former <code>irrigation</code> and <code>draining</code> columns from the output data.frame of <code>albufera_hb_local()</code> became <code>ideal_irrigation</code> and <code>ideal_draining</code>, to better reflect that these correspond to the originally scheduled irrigation and draining plans. In addition, new columns <code>real_irrigation</code> and <code>real_draining</code> were added to the data.frame, which provide the actual irrigation and draining plans followed, modified by the plan delay.</p></li>
</ul></div>
<div class="section level4">
<h4 id="new-features-0-5-0">New features<a class="anchor" aria-label="anchor" href="#new-features-0-5-0"></a></h4>
<ul><li>Visualizations of the “extra outflow” variable have been added to the global hydrological balance module of the Shiny dashboard.</li>
</ul></div>
<div class="section level4">
<h4 id="bug-fixes-0-5-0">Bug fixes<a class="anchor" aria-label="anchor" href="#bug-fixes-0-5-0"></a></h4>
<ul><li>Fixed broken functionality of ‘height_thresh_cm’ argument (<a href="https://github.com/erahumed/erahumed/issues/85" class="external-link">#85</a>).</li>
<li>Correct bug that was causing the wrong delay being applied to <code>seed_day</code> in the <code>ca_choose_application_day_index()</code> helper, building block of <code><a href="../reference/ca.html">ca()</a></code>.</li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-5-0">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-5-0"></a></h4>
<ul><li>Unit testing of CA model block (<a href="https://github.com/erahumed/erahumed/issues/77" class="external-link">#77</a>).</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.4.1" id="erahumed-041">erahumed 0.4.1<a class="anchor" aria-label="anchor" href="#erahumed-041"></a></h2>
<div class="section level4">
<h4 id="new-features-0-4-1">New features<a class="anchor" aria-label="anchor" href="#new-features-0-4-1"></a></h4>
<ul><li>First draft of <code><a href="../reference/plot.erahumed_ca.html">plot.erahumed_ca()</a></code> (“cluster view”).</li>
</ul></div>
<div class="section level4">
<h4 id="user-visible-changes-0-4-1">User visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-0-4-1"></a></h4>
<ul><li><p>The default for the <code>height_thresh_cm</code> parameter of <code><a href="../reference/ca.html">ca()</a></code> has been changed from <code>2.5</code> to <code>2</code>.</p></li>
<li><p>The <code>albufera_management</code> data-set has a new column <code>seed_day</code>, which counts the number of day elapsed from the sowing day. This is also returned in the output data.frame of <code>albufera_hb_local()</code>.</p></li>
<li><p><code>erahumed_ca</code> S3 class now inherits from <code>hb_local</code>.</p></li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-4-1">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-4-1"></a></h4>
<ul><li><p>Improvement in data.frame validity checks. The <code>assert_data.frame()</code> helper is now able to check column types. Noteworthy, this allows for much stricter tests in the <code>"hb_local"</code> and <code>"hb_global"</code> functions.</p></li>
<li><p>Important performance improvements in the function <code><a href="../reference/ca.html">ca()</a></code>. These were mainly achieved by (i) removing validity checks in the low level function <code>ca_to_cluster()</code>, supplanted by less costly checks at the level of the <code>hb_local()</code> output; and (ii) bypassing computation using <code>Date</code> objects, thanks to the introduced <code>seed_day</code> column in the output of <code>albufera_hb_local()</code> (see above).</p></li>
</ul></div>
<div class="section level4">
<h4 id="documentation-0-4-1">Documentation<a class="anchor" aria-label="anchor" href="#documentation-0-4-1"></a></h4>
<ul><li>Improved documentation of <code>albufera_hb_global()</code> default parameters.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.4.0" id="erahumed-040">erahumed 0.4.0<a class="anchor" aria-label="anchor" href="#erahumed-040"></a></h2>
<div class="section level4">
<h4 id="new-features-0-4-0">New features<a class="anchor" aria-label="anchor" href="#new-features-0-4-0"></a></h4>
<p>This version introduces a first draft for the new Chemicals Applications (CA) model block, which is meant to simulate the application of chemicals (fertilizers and pesticides), according to the previously obtained simulation of local water levels and water flows, which is the output of the hydrological balance (HB) block.</p>
<p>The basic <code><a href="../reference/ca.html">ca()</a></code> function is provided, which takes as input an object of S3 class <code>"hb_local"</code> (plus a few other optional input parameters), and returns a similar data-frame, with additional columns that provide the time series of chemical applications.</p>
<p>The accompanying dataset <code>albufera_ca_schedules</code> provides the schedules for chemical applications in the Albufera lake, and is one of the customizable inputs to <code><a href="../reference/ca.html">ca()</a></code>.</p>
</div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.3.2" id="erahumed-032">erahumed 0.3.2<a class="anchor" aria-label="anchor" href="#erahumed-032"></a></h2>
<div class="section level4">
<h4 id="under-the-hoods-0-3-2">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-3-2"></a></h4>
<ul><li><p>Shiny app continues to work if the Albufera Leaflet map cannot be loaded for any reason.</p></li>
<li><p>Added validation of date range to <code>albufera_hb_local()</code>.</p></li>
<li><p>Tested exceptions raised by <code>albufera_hb_local()</code>s argument validity checks.</p></li>
<li><p>Documented plotting method for <code>hb_local</code> and <code>hb_global</code> S3 objects.</p></li>
</ul></div>
<div class="section level4">
<h4 id="miscellaneous-0-3-2">Miscellaneous<a class="anchor" aria-label="anchor" href="#miscellaneous-0-3-2"></a></h4>
<ul><li>Added Pablo Amador and Andreu Rico to package <a href="mailto:Authors@R" class="email">Authors@R</a>.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.3.1" id="erahumed-031">erahumed 0.3.1<a class="anchor" aria-label="anchor" href="#erahumed-031"></a></h2>
<div class="section level4">
<h4 id="user-visible-changes-0-3-1">User visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-0-3-1"></a></h4>
<ul><li><p><code>albufera_hb_local()</code>, called with default arguments, now retrieves its value from disk, from data installed alongside with <a href="https://github.com/erahumed/erahumed" class="external-link">erahumed</a>.</p></li>
<li><p>Due to the previous point, the package’s .tar.gz file size is much larger now, approximately 50MB. The file size will be tackled, as much as possible, in later releases.</p></li>
<li><p>Added light <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> and <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> methods for the S3 objects returned by <code>albufera_hb_local()</code> and <code>albufera_hb_global()</code>.</p></li>
<li><p><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a> is no longer attached upon attaching <a href="https://github.com/erahumed/erahumed" class="external-link">erahumed</a>.</p></li>
</ul></div>
<div class="section level4">
<h4 id="bug-fixes-0-3-1">Bug fixes<a class="anchor" aria-label="anchor" href="#bug-fixes-0-3-1"></a></h4>
<ul><li>Package data is prefixed everywhere in the code by the <code>erahumed::</code> NAMESPACE, so that executing this code without having the package attached does not lead to errors. In particular, calling <code><a href="../reference/launch_app.html">erahumed::launch_app()</a></code> without attaching <a href="https://github.com/erahumed/erahumed" class="external-link">erahumed</a> does no longer lead to an error.</li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-3-1">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-3-1"></a></h4>
<ul><li>Fixed R-CMD-check spurious NOTEs.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.3.0" id="erahumed-030">erahumed 0.3.0<a class="anchor" aria-label="anchor" href="#erahumed-030"></a></h2>
<div class="section level4">
<h4 id="user-visible-changes-0-3-0">User visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-0-3-0"></a></h4>
<ul><li>New Shiny module to set parameters of the hydrological balance calculations.</li>
<li>New Shiny module to modify input data to the algorithms.</li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-3-0">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-3-0"></a></h4>
<ul><li>Added shinytest2 testing infrastructure, for snapshot based tests to be developed later.</li>
<li>Basic tests for plotting utilities (succeed with default arguments).</li>
<li>Server testing of <code>hb_shiny.R</code> modules, <a href="https://github.com/erahumed/erahumed/issues/15" class="external-link">#15</a>.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.2.2" id="erahumed-022">erahumed 0.2.2<a class="anchor" aria-label="anchor" href="#erahumed-022"></a></h2>
<div class="section level4">
<h4 id="user-visible-changes-0-2-2">User visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-0-2-2"></a></h4>
<ul><li><p>Documentation for the <code>albufera_hb_global()</code> and <code>albufera_hb_local()</code> wrappers.</p></li>
<li><p>Exported <code>hbg_residence_time()</code> doc page.</p></li>
<li><p>Former <code>albufera_weather</code> dataset becomes <code>albufera_petp</code>, and its structure is significantly simplified, now having only three columns: <code>date</code>, <code>rain_mm</code> and <code>evapotranspiration_mm</code> (previously named <code>date</code>, <code>P</code> and <code>ETP</code> respectively). All changes get propagated to downstream tables, such as <em>e.g.</em> <code>albufera_hb_global()</code>.</p></li>
</ul></div>
<div class="section level4">
<h4 id="algorithm-change-0-2-2">Algorithm change<a class="anchor" aria-label="anchor" href="#algorithm-change-0-2-2"></a></h4>
<ul><li>In previous versions of the algorithm, the plan delays upon failing to reach zero water levels on a given date were only being applied to the <code>ideal_height_cm</code> vector. In the present version, the draining and irrigation plan also get delayed. This has been observed to give rise to slightly more natural water profiles (in particular, the delay accumulated during summer is often less than 40 days, contrary to what used to happen with the previous version).</li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-2-2">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-2-2"></a></h4>
<ul><li>Add <code>"hb_local"</code> S3 class internal constructor (<a href="https://github.com/erahumed/erahumed/issues/21" class="external-link">#21</a>).</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.2.1" id="erahumed-021">erahumed 0.2.1<a class="anchor" aria-label="anchor" href="#erahumed-021"></a></h2>
<div class="section level4">
<h4 id="user-visible-changes-0-2-1">User visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-0-2-1"></a></h4>
<ul><li><p>Default arguments of <code>albufera_hb_global()</code> and <code>albufera_hb_local()</code> are now prepended with the <code>erahumed::</code> namespace specifier.</p></li>
<li><p>Unexported <code>residence_time()</code></p></li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-2-1">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-2-1"></a></h4>
<ul><li><p>Separated logical units of <code>hb_global()</code>, collected in <code>hb_global_units.R</code>.</p></li>
<li><p>Introduced argument checking for <code>hb_global()</code> and its wrapper <code>albufera_hb_global()</code>.</p></li>
<li><p>Introduced S3 class constructor for <code>"hb_global"</code> class objects (see <code>hb_global_units_s3_class.R</code>).</p></li>
<li><p>Important improvements in the testing infrastructure of <code>hb_global()</code> and<br><code>albufera_hb_global()</code>, both at the algorithmic level (through testing of <code>hb_global_units.R</code>) and at the level of exceptions raised by these two functions.</p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.2.0" id="erahumed-020">erahumed 0.2.0<a class="anchor" aria-label="anchor" href="#erahumed-020"></a></h2>
<div class="section level4">
<h4 id="user-visible-changes-0-2-0">User visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-0-2-0"></a></h4>
<ul><li><p>Reduced number of <code>*_is_imputed</code> entries in <code>hb_global</code> dataframes. Right now we are only providing <code>level_is_imputed</code> and <code>outflow_is_imputed</code>, which should suffice FAPP.</p></li>
<li><p>Big refactoring of the HB sector naming conventions. The wrappers become <code>albufera_hb_global/local()</code>, and the underlying functions are <code>hb_global/local()</code>.</p></li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-2-0">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-2-0"></a></h4>
<ul><li>We complete the work started with v0.1.2 to separate the algorithms for computing global and local hydrological balance, from the wrappers used to feed this algorithms with our prepared datasets. In this version, the wrappers got significantly simplified, their only function being extracting variables from the imported datasets and feeding them to the algorithms (as it should be).</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.1.2" id="erahumed-012">erahumed 0.1.2<a class="anchor" aria-label="anchor" href="#erahumed-012"></a></h2>
<div class="section level4">
<h4 id="user-visible-changes-0-1-2">User visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-0-1-2"></a></h4>
<ul><li>Improved appearance of cluster level plots in Shiny app UI.</li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-1-2">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-1-2"></a></h4>
<ul><li><p>Important code refactors for the local balance algorithm, aiming to separate the abstract logic of the algorithm from our specific conventions used to pack together data for hydrological balance - the latter conventions being relegated to <code>hb_wrappers.R</code> functions. Fixes <a href="https://github.com/erahumed/erahumed/issues/3" class="external-link">#3</a>.</p></li>
<li><p>Extensive unit testing of the logical units for the local balance algorithm.</p></li>
<li><p>Performance optimizations in local balance algorithm.</p></li>
<li><p>Sanity check functional tests for <code>plot.hb_local()</code> and <code>plot.hb_global()</code>.</p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.1.1" id="erahumed-011">erahumed 0.1.1<a class="anchor" aria-label="anchor" href="#erahumed-011"></a></h2>
<div class="section level4">
<h4 id="algorithm-0-1-1">Algorithm<a class="anchor" aria-label="anchor" href="#algorithm-0-1-1"></a></h4>
<ul><li>The main algorithm for local balance has been modified in such a way to ensure that the correct number of emptying events is always produced. This is achieved by delaying (by one day) the ideal water level plan whenever the ideal level is zero and the real level is above a certain threshold (2.5 mm by default). Moreover, outside of the sowing season, the water level plan is reset to the original one, in such a way that the Perellona does not get delayed.</li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-1-1">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-1-1"></a></h4>
<ul><li>Re-enabled continuous integration, with some internal code improvements.</li>
<li>Sanitizing of warnings/notes from R-cmd-check.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.1.0" id="erahumed-010">erahumed 0.1.0<a class="anchor" aria-label="anchor" href="#erahumed-010"></a></h2>
<div class="section level4">
<h4 id="algorithm-0-1-0">Algorithm<a class="anchor" aria-label="anchor" href="#algorithm-0-1-0"></a></h4>
<ul><li>Switched to an improved version of the algorithm to compute the local balance at the cluster level. The exactness of total outflows is enforced, in such a way that the sum of outflows of cluster that belong to a given ditch equals the total inflow to the Albufera lake from said ditch. Also, the logic of the algorithm was changed in such a way to enforce that no evaporation can occur when the water level of a cluster is zero. <strong>Warning.</strong> While correctly enforcing mass conservation, the present algorithm does not guarantee that the clusters will always be emptied for periods as long as planned, for the application of pesticides - both aspects being at odds with the previous version. Correctly enforcing the emptying of clusters will is the object of ongoing work.</li>
</ul></div>
<div class="section level4">
<h4 id="ui-0-1-0">UI<a class="anchor" aria-label="anchor" href="#ui-0-1-0"></a></h4>
<ul><li>The cluster to be plotted in the local balance tab of the shiny app can now be selected from an interactive leaflet map of the Albufera National Park.</li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-1-0">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-1-0"></a></h4>
<ul><li><p>Added internal utility <code>erahumed:::plot_albufera_clusters()</code> to obtain a leaflet map of clusters.</p></li>
<li><p>Added internal utility <code>erahumed:::plot_albufera_management()</code> to obtain a plot of ideal water levels vs. day of year.</p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.6" id="erahumed-006">erahumed 0.0.6<a class="anchor" aria-label="anchor" href="#erahumed-006"></a></h2>
<div class="section level4">
<h4 id="under-the-hoods-0-0-6">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-0-6"></a></h4>
<ul><li>Fixed an important bug that was causing real outflows to be zero in most cases.</li>
</ul></div>
<div class="section level4">
<h4 id="testing-0-0-6">Testing<a class="anchor" aria-label="anchor" href="#testing-0-0-6"></a></h4>
<ul><li>Added important functional tests for real outflows. In particular, we test that the sum of real outflows for clusters belonging to a given ditch is always equal to the minimum between the total ditch’s capacity and ideal required outflow.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.5" id="erahumed-005">erahumed 0.0.5<a class="anchor" aria-label="anchor" href="#erahumed-005"></a></h2>
<ul><li><p>The outputs of <code>albufera_hydro_balance_global()</code> and <code>albufera_hydro_balance_local()</code> get class attributes <code>"hb_global"</code> and <code>"hb_local"</code>, respectively.</p></li>
<li><p>Added cluster level plots to the shiny UI.</p></li>
</ul><div class="section level4">
<h4 id="under-the-hoods-0-0-5">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-0-5"></a></h4>
<ul><li>New plot methods for <code>"hb_global"</code> and <code>"hb_local"</code> S3 classes. Currently not exported to NAMESPACE.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.4" id="erahumed-004">erahumed 0.0.4<a class="anchor" aria-label="anchor" href="#erahumed-004"></a></h2>
<div class="section level4">
<h4 id="under-the-hoods-0-0-4">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-0-4"></a></h4>
<ul><li><p>Ordering of clusters sampled by the local hydrological balance simulation algorithm does not depend anymore on the way these clusters are sorted in the input data.</p></li>
<li><p>Fixed issues in the logic of local hydrological balance.</p></li>
<li><p>Improved testing infrastructure</p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.3" id="erahumed-003">erahumed 0.0.3<a class="anchor" aria-label="anchor" href="#erahumed-003"></a></h2>
<div class="section level4">
<h4 id="user-visible-changes-0-0-3">User-visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-0-0-3"></a></h4>
<ul><li><p>Big namespace refactor: all datasets get prepended with the prefix <code>"albufera_"</code>.</p></li>
<li><p>The functions <code>albufera_storage_curve()</code> and <code>petp_volume_change()</code> were substituted by the function <em>factories</em> <code>linear_storage_curve()</code> and <code>linear_petp_function()</code>, that create functions that perform affine transformations.</p></li>
<li><p>Function <code>albufera_hydro_balance()</code> was renamed <code>albufera_hydro_balance_global()</code>. Ditch inflows are not returned anymore. In correspondence, we add a new function <code>albufera_hydro_balance_local()</code>, which at the current moment is still WIP and for testing purposes.</p></li>
<li><p>Functions <code>albufera_hydro_balance_*()</code> now allow to specify storage curve and P-ETP surface by dedicated arguments. The defaults are defined throughout the new helpers mentioned in a previous point.</p></li>
<li><p>New function <code>hydro_balance_global()</code>, that is meant to capture the abstract part of the global hydrological balance calculations. The function <code>albufera_hydro_balance()</code> relies on this for its calculations of global balance.</p></li>
<li><p>Residence time is now computed in terms of the total outflow, rather than inflow as before. This reflects the way we handle cases of unaccounted outflow in <code>hydro_balance_global()</code> (set inflow to zero).</p></li>
</ul></div>
<div class="section level4">
<h4 id="documentation-0-0-3">Documentation<a class="anchor" aria-label="anchor" href="#documentation-0-0-3"></a></h4>
<ul><li>Improved documentation of the <code>hydro_balance_global()</code> function, as well as other minor improvements on documentation of helpers.</li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-0-3">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-0-3"></a></h4>
<ul><li>Started to work consistently on the testing infrastructure.</li>
</ul></div>
<div class="section level4">
<h4 id="notes-0-0-3">Notes<a class="anchor" aria-label="anchor" href="#notes-0-0-3"></a></h4>
<ul><li>Function names and the general API of these early versions of the package are understood to be provisional.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.2" id="erahumed-002">erahumed 0.0.2<a class="anchor" aria-label="anchor" href="#erahumed-002"></a></h2>
<ul><li><p>Added <code>clusters</code> and <code>cluster_geometries</code> datasets, containing information at the cluster (i.e. aggregate of rice paddies) level.</p></li>
<li><p>Separated computation of ditch inflow percents in a new function, <code>compute_ditch_inflow_pct()</code>, that leverages on the <code>clusters</code> dataset.</p></li>
<li><p>Corrected calculation of total outflow. In this calculation, the Perello daily outflow was being set to zero in the case of negative values. This does not make sense with the current computational approach.</p></li>
<li><p>Updated the <code>paddy_management</code> dataset: the irrigation and draining input binary vectors used previously were incomplete, with data until the middle of August. For this version, the inputs are defined until the 10th of September.</p></li>
</ul></div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.1" id="erahumed-001">erahumed 0.0.1<a class="anchor" aria-label="anchor" href="#erahumed-001"></a></h2>
<p>First release. Contains a draft of the utilities for hydrological balance data analysis, and a skeleton of the visualization app (currently invoked with <code><a href="../reference/launch_app.html">launch_app()</a></code>).</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Valerio Gherardi, Pablo Amador.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

