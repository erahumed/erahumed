<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Changelog • erahumed</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Changelog"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">erahumed</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.16.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/ct-diagram.html">Diagram of physical processes for chemical transport</a></li>
    <li><a class="dropdown-item" href="../articles/erahumed-workflow.html">Simulation workflow</a></li>
    <li><a class="dropdown-item" href="../articles/hydrology-scheme.html">Hydrological model of the Albufera Natural Park</a></li>
    <li><a class="dropdown-item" href="../articles/pipeline-scheme.html">Scheme of the simulation pipeline</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/erahumed/erahumed/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-news">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Changelog</h1>
      <small>Source: <a href="https://github.com/erahumed/erahumed/blob/master/NEWS.md" class="external-link"><code>NEWS.md</code></a></small>
    </div>

    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.16.2" id="erahumed-0162">erahumed 0.16.2<a class="anchor" aria-label="anchor" href="#erahumed-0162"></a></h2>
<p>This version provides an important reshaping of the “Output”” section of the GUI. Plot methods have been harmonized across the various hydrological elements, and the interface has been structured in such a way to show at any time the three simulation component (Hydrology, Exposure and Risk) results for an individual element (either a cluster, a ditch or the Albufera lake).</p>
<p>Specific changes are discussed below.</p>
<div class="section level4">
<h4 id="algorithm-0-16-2">Algorithm<a class="anchor" aria-label="anchor" href="#algorithm-0-16-2"></a></h4>
<ul><li><p><code><a href="../reference/erahumed_parameters.html">setup_hydrology()</a></code> no longer accepts functional inputs for former the storage curve and PETP-function. Arguments <code>storage_curve</code> and <code>petp_function</code>, which used to require function inputs, are now replaced by <code>storage_curve_slope_m2</code>, <code>storage_curve_intercept_m3</code> and <code>petp_surface_m2</code>.</p></li>
<li><p>In all risk calculations, pesticide densities are now regarded to be zero whenever the water volume of an hydrological element is zero (concretely, this only happens for rice cluster at present). The former treatment regarded them as <code>NA</code>. Notice that this affects, in particular, the definition of chronic risk.</p></li>
</ul></div>
<div class="section level4">
<h4 id="visualization-0-16-2">Visualization<a class="anchor" aria-label="anchor" href="#visualization-0-16-2"></a></h4>
<ul><li><p>New implementations for hydrology plots, separating “flow” and “storage” plots, and volume <em>vs.</em> depth plots (this latter chosen through a radio button in the GUI).</p></li>
<li><p>We start using <code>PAF / sum(PAF)</code> to provide a heuristic for relative contributions of individual toxic modes of action to the total <code>msPAF</code>.</p></li>
<li><p>Various improvements in plot axes and legends.</p></li>
<li><p>Pesticide names have been corrected (NB: this change is immediately noticed and mostly relevant for visualizations, but it actually also affects the simulation outputs in R).</p></li>
<li><p>Chemical density time-series for sediment and water are now separated. No plotting option is provided for foliage.</p></li>
<li><p>Chemical densities in sediment are now reported in <code>mg / g</code> units.</p></li>
</ul></div>
<div class="section level4">
<h4 id="gui-0-16-2">GUI<a class="anchor" aria-label="anchor" href="#gui-0-16-2"></a></h4>
<ul><li><p>New <code>'Download Results'</code> button (<a href="https://github.com/erahumed/erahumed/issues/244" class="external-link">#244</a>).</p></li>
<li><p>Former “cluster” picker input becomes a “water body” element picker.</p></li>
<li><p>Card-specific settings for the “Hydrology”, “Exposure” and “Risk” cards of the output tab are now placed inside a popover triggered from a gear icon-like button (<a href="https://github.com/erahumed/erahumed/issues/321" class="external-link">#321</a>).</p></li>
<li><p>Plots were resized to a fixed <code>600px</code> size.</p></li>
<li><p>New (much clearer) naming scheme of clusters and ditches.</p></li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-16-2">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-16-2"></a></h4>
<ul><li>The list of chemicals available for selection in the GUI is no longer retrieved from simulation outputs, being now simply given by <code>names(info_chemicals())</code>. The changes needed for the case of defining custom chemicals will be addressed elsewhere.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.16.1" id="erahumed-0161">erahumed 0.16.1<a class="anchor" aria-label="anchor" href="#erahumed-0161"></a></h2>
<div class="section level4">
<h4 id="gui-0-16-1">GUI<a class="anchor" aria-label="anchor" href="#gui-0-16-1"></a></h4>
<ul><li><p>The X ranges of time series plots in the Output section are now synchronized (<a href="https://github.com/erahumed/erahumed/issues/231" class="external-link">#231</a>).</p></li>
<li><p>Parameter updates trigger a notification that prompts the user to re-run the simulation (<a href="https://github.com/erahumed/erahumed/issues/301" class="external-link">#301</a>).</p></li>
<li><p>Date range input is now a <code><a href="https://dreamrs.github.io/shinyWidgets/reference/airDatepicker.html" class="external-link">shinyWidgets::airDatepickerInput()</a></code> (<a href="https://github.com/erahumed/erahumed/issues/269" class="external-link">#269</a>).</p></li>
<li><p>Run button functionality restored (<a href="https://github.com/erahumed/erahumed/issues/309" class="external-link">#309</a>).</p></li>
<li><p>A new <code>selectInput()</code> allows to choose the type of risk to be plotted (acute <em>vs.</em> chronic).</p></li>
<li><p>A new radio button allows to choose whether to show mass or density in exposure plots.</p></li>
<li><p>Card headers in the Output section are now colored in black.</p></li>
</ul></div>
<div class="section level4">
<h4 id="dependencies-0-16-1">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies-0-16-1"></a></h4>
<ul><li>We start importing <a href="https://github.com/dreamRs/shinyWidgets" class="external-link">shinyWidgets</a>.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.16.0" id="erahumed-0160">erahumed 0.16.0<a class="anchor" aria-label="anchor" href="#erahumed-0160"></a></h2>
<p>This version provides the first implementation of risk assessment through SSDs.</p>
<div class="section level4">
<h4 id="new-features-0-16-0">New features<a class="anchor" aria-label="anchor" href="#new-features-0-16-0"></a></h4>
<ul><li>
<code>get_results(component = "risk")</code> can now be used to retrieve simulation outputs for risk.</li>
</ul></div>
<div class="section level4">
<h4 id="gui-0-16-0">GUI<a class="anchor" aria-label="anchor" href="#gui-0-16-0"></a></h4>
<ul><li>New risk plots available in the Output tab of the app.</li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-16-0">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-16-0"></a></h4>
<ul><li>
<code>cluster_id</code> and <code>ditch</code> columns of the respective <code>ctc</code> and <code>ctd</code> layers have been renamed to <code>element_id</code>.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.15.1" id="erahumed-0151">erahumed 0.15.1<a class="anchor" aria-label="anchor" href="#erahumed-0151"></a></h2>
<p>This version implements the simulation of pesticide concentration dynamics in ditches and in the Albufera lake.</p>
<div class="section level4">
<h4 id="algorithm-changes-0-15-1">Algorithm changes<a class="anchor" aria-label="anchor" href="#algorithm-changes-0-15-1"></a></h4>
<ul><li>Corrected volume calculations in the internal algorithm for computing chemical concentration time series - the new implementation is considerably simpler and entirely relies on the previous calculations performed in the “hydrology” layers.</li>
</ul></div>
<div class="section level4">
<h4 id="new-features-0-15-1">New features<a class="anchor" aria-label="anchor" href="#new-features-0-15-1"></a></h4>
<ul><li>
<code>get_results(component = "exposure")</code>, with <code>element = "ditch"</code> or <code>element = "lake"</code> can now be used to retrieve simulation outputs for exposure.</li>
</ul></div>
<div class="section level4">
<h4 id="gui-0-15-1">GUI<a class="anchor" aria-label="anchor" href="#gui-0-15-1"></a></h4>
<ul><li>Pesticide to be plotted in exposure plots in the “Output” tab can now be selected through a selectInput UI element (<a href="https://github.com/erahumed/erahumed/issues/293" class="external-link">#293</a>).</li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-15-1">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-15-1"></a></h4>
<ul><li><p>Removed <code>compute_layer()</code> helper, no longer used.</p></li>
<li><p>Plot methods for CT layers now have a “chemicals” argument, that allows to choose what chemicals to plot.</p></li>
<li><p>Code refactor of chemical transport helpers (<a href="https://github.com/erahumed/erahumed/issues/288" class="external-link">#288</a>, <a href="https://github.com/erahumed/erahumed/issues/289" class="external-link">#289</a>, <a href="https://github.com/erahumed/erahumed/issues/290" class="external-link">#290</a>, <a href="https://github.com/erahumed/erahumed/issues/291" class="external-link">#291</a>).</p></li>
</ul></div>
<div class="section level4">
<h4 id="testing-0-15-1">Testing<a class="anchor" aria-label="anchor" href="#testing-0-15-1"></a></h4>
<ul><li><p>Tests are stopped early if the creation of mock simulation objects fails.</p></li>
<li><p>Various improvements in the testing infrastructure.</p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.15.0" id="erahumed-0150">erahumed 0.15.0<a class="anchor" aria-label="anchor" href="#erahumed-0150"></a></h2>
<p>This release comes with a fresh new (simplified) API that drastically reduces the number of functions exported by the package. The old concept of “simulation layer” is no longer exposed to the end user, which only has to deal with much more intuitive concepts such as:</p>
<ul><li>Simulation components: <em>hydrology</em>, <em>exposure</em> and <em>risk</em>.</li>
<li>Landscape elements: <em>lake</em>, <em>ditch</em>, and <em>cluster</em>.</li>
</ul><p>The usage of the new API is exemplified in the updated <a href="https://erahumed.github.io/erahumed/articles/erahumed-workflow.html">main package vignette</a>. Below are listed specific changes:</p>
<div class="section level4">
<h4 id="api-changes-0-15-0">API changes<a class="anchor" aria-label="anchor" href="#api-changes-0-15-0"></a></h4>
<ul><li><p>Removed <code>setup_inp()</code>, <code>setup_hba()</code>, <code>setup_hbp()</code>, <code>setup_hbd()</code>, <code>setup_ca()</code>, <code>setup_ct()</code> functions, in favor of <code><a href="../reference/erahumed_parameters.html">setup_hydrology()</a></code>, <code><a href="../reference/erahumed_parameters.html">setup_exposure()</a></code> and <code><a href="../reference/erahumed_parameters.html">setup_risk()</a></code> (<a href="https://github.com/erahumed/erahumed/issues/272" class="external-link">#272</a>).</p></li>
<li><p>Removed <code>erahumed_layers()</code> helper.</p></li>
<li><p><code><a href="../reference/run_simulation.html">run_simulation()</a></code> loses its <code>layer</code> argument: simulation can only be run all at once (<a href="https://github.com/erahumed/erahumed/issues/279" class="external-link">#279</a>).</p></li>
<li><p>Removed <code>get_layer_output()</code> helper in favor of <code><a href="../reference/get_results.html">get_results()</a></code>.</p></li>
<li><p>Removed <code>get_layer_parameters()</code>, <code>get_layer_aux()</code> and <code>get_layer()</code> from public API, with no function replacing their functionality (considered unnecessary at the moment).</p></li>
<li><p>Removed old layers’ <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> S3 methods.</p></li>
</ul></div>
<div class="section level4">
<h4 id="data-0-15-0">Data<a class="anchor" aria-label="anchor" href="#data-0-15-0"></a></h4>
<ul><li>Updated observational input data <code>albufera_outflows</code> and <code>albufera_weather</code> with data until 2024 (included).</li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-15-0">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-15-0"></a></h4>
<ul><li>Defined a single helper to compute the time series of pesticides in clusters, ditches and in the lake, the latter two functionalities still to be implemented (<a href="https://github.com/erahumed/erahumed/issues/275" class="external-link">#275</a>).</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.14.3" id="erahumed-0143">erahumed 0.14.3<a class="anchor" aria-label="anchor" href="#erahumed-0143"></a></h2>
<div class="section level4">
<h4 id="gui-0-14-3">GUI<a class="anchor" aria-label="anchor" href="#gui-0-14-3"></a></h4>
<ul><li>The tab initially selected upon app initialization is now the “Output” tab (<a href="https://github.com/erahumed/erahumed/issues/169" class="external-link">#169</a>).</li>
<li>Added a “Run simulation” button that allows to update the outputs when parameters are modified (first step towards addressing <a href="https://github.com/erahumed/erahumed/issues/194" class="external-link">#194</a>).</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.14.2" id="erahumed-0142">erahumed 0.14.2<a class="anchor" aria-label="anchor" href="#erahumed-0142"></a></h2>
<div class="section level4">
<h4 id="modeling-advances-0-14-2">Modeling advances<a class="anchor" aria-label="anchor" href="#modeling-advances-0-14-2"></a></h4>
<ul><li>New simulation layer HBD (“Hydrological Balance of Ditches”), with corresponding setup function <code>setup_hbd()</code> and <code>plot.erahumed_hbd()</code> method. The results from the layer are also included in the Shiny GUI.</li>
</ul></div>
<div class="section level4">
<h4 id="documentation-0-14-2">Documentation<a class="anchor" aria-label="anchor" href="#documentation-0-14-2"></a></h4>
<ul><li>Unified description and title of layers across Shiny app and R documentation.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.14.1" id="erahumed-0141">erahumed 0.14.1<a class="anchor" aria-label="anchor" href="#erahumed-0141"></a></h2>
<div class="section level4">
<h4 id="api-changes-0-14-1">API changes<a class="anchor" aria-label="anchor" href="#api-changes-0-14-1"></a></h4>
<ul><li>Changed <code>height_thresh_cm</code> default value to ‘0.5’ (<a href="https://github.com/erahumed/erahumed/issues/242" class="external-link">#242</a>)</li>
</ul></div>
<div class="section level4">
<h4 id="documentation-0-14-1">Documentation<a class="anchor" aria-label="anchor" href="#documentation-0-14-1"></a></h4>
<ul><li>Add <code>ct-diagram</code>: “Diagram of physical processes for chemical transport”.</li>
</ul></div>
<div class="section level4">
<h4 id="dependencies-0-14-1">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies-0-14-1"></a></h4>
<ul><li>Dropped <a href="http://rstudio.github.io/shinydashboard/" class="external-link">shinydashboard</a> Imports dependency.</li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-14-1">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-14-1"></a></h4>
<ul><li>Removed old DSS-v0 app and related server functions</li>
</ul></div>
<div class="section level4">
<h4 id="testing-0-14-1">Testing<a class="anchor" aria-label="anchor" href="#testing-0-14-1"></a></h4>
<ul><li>Updated server tests for <code>&lt;layer&gt;_input_server()</code> servers</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.14.0" id="erahumed-0140">erahumed 0.14.0<a class="anchor" aria-label="anchor" href="#erahumed-0140"></a></h2>
<div class="section level4">
<h4 id="new-features-0-14-0">New features<a class="anchor" aria-label="anchor" href="#new-features-0-14-0"></a></h4>
<ul><li>New screenshot feature in Shiny app (<a href="https://github.com/erahumed/erahumed/issues/230" class="external-link">#230</a>).</li>
<li>New plot type for CT simulation outputs accessible via <code>plot.erahumed_ct(type = "max_boxplot")</code>, which provides a visualization of the distribution of maximum pesticide concentration across clusters (<a href="https://github.com/erahumed/erahumed/issues/212" class="external-link">#212</a>).</li>
</ul></div>
<div class="section level4">
<h4 id="api-improvements-0-14-0">API improvements<a class="anchor" aria-label="anchor" href="#api-improvements-0-14-0"></a></h4>
<ul><li>Stricter argument validation for <code>management_df</code> of <code>setup_hbp()</code> (<a href="https://github.com/erahumed/erahumed/issues/216" class="external-link">#216</a>).</li>
</ul></div>
<div class="section level4">
<h4 id="gui-improvements-0-14-0">GUI Improvements<a class="anchor" aria-label="anchor" href="#gui-improvements-0-14-0"></a></h4>
<ul><li>UI elements that take long to compute now show a spinner (<a href="https://github.com/erahumed/erahumed/issues/227" class="external-link">#227</a>).</li>
<li>Restored selection of cluster from the Albufera interactive map (<a href="https://github.com/erahumed/erahumed/issues/229" class="external-link">#229</a>).</li>
<li>Clusters in the Albufera interactive map are now color-coded by rice variety.</li>
<li>Added informative ‘disconnected’ screen using <a href="https://sever.john-coene.com/" class="external-link">sever</a> (<a href="https://github.com/erahumed/erahumed/issues/179" class="external-link">#179</a>).</li>
<li>Albufera map UI element is hidden on app startup (<a href="https://github.com/erahumed/erahumed/issues/226" class="external-link">#226</a>).</li>
</ul></div>
<div class="section level4">
<h4 id="documentation-0-14-0">Documentation<a class="anchor" aria-label="anchor" href="#documentation-0-14-0"></a></h4>
<ul><li>Added informative tooltips for all model parameters in the Shiny app (<a href="https://github.com/erahumed/erahumed/issues/223" class="external-link">#223</a>).</li>
<li>Added column descriptions in the CSV input UI (<a href="https://github.com/erahumed/erahumed/issues/224" class="external-link">#224</a>).</li>
<li>New “About” modal in Shiny app (<a href="https://github.com/erahumed/erahumed/issues/171" class="external-link">#171</a>).</li>
<li>Add new vignette with the scheme of the model’s hydrology.</li>
<li>Removed “experimental” badge from <code>?ct</code> documentation (<a href="https://github.com/erahumed/erahumed/issues/192" class="external-link">#192</a>).</li>
<li>Corrected typo in <code><a href="../reference/launch_dss.html">launch_dss()</a></code> command in README (<a href="https://github.com/erahumed/erahumed/issues/241" class="external-link">#241</a>).</li>
<li>Improved description of <code>ca_schedules_df</code> parameter in <code>?ca</code>.</li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-14-0">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-14-0"></a></h4>
<ul><li>Reduced code redundancy in <code>setup_*()</code> functions by capturing arguments of function call and passing down directly to underlying <code>setup_layer()</code> (<a href="https://github.com/erahumed/erahumed/issues/179" class="external-link">#179</a>).</li>
<li>Moved argument validation of <code>setup_*()</code> functions to main body (close <a href="https://github.com/erahumed/erahumed/issues/205" class="external-link">#205</a>).</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.13.0" id="erahumed-0130">erahumed 0.13.0<a class="anchor" aria-label="anchor" href="#erahumed-0130"></a></h2>
<p>This release comes with a whole new Shiny GUI, modeled after the ideas discussed in <a href="https://github.com/erahumed/erahumed/issues/214" class="external-link">#214</a>. The GUI is still largely work in progress, but the various required improvements will be diluted in following releases to better organize work. The new app moves away from <a href="http://rstudio.github.io/shinydashboard/" class="external-link">shinydashboard</a>, instead using the layouts provided by the active <a href="https://rstudio.github.io/bslib/" class="external-link">bslib</a>, addressing <a href="https://github.com/erahumed/erahumed/issues/211" class="external-link">#211</a>.</p>
<p>Specific changes are discussed below.</p>
<div class="section level4">
<h4 id="new-features-0-13-0">New features<a class="anchor" aria-label="anchor" href="#new-features-0-13-0"></a></h4>
<ul><li>New Shiny app providing the GUI modeled after <a href="https://github.com/erahumed/erahumed/issues/214" class="external-link">#214</a>. This can be accessed via <code><a href="../reference/launch_dss.html">launch_dss()</a></code>.</li>
</ul></div>
<div class="section level4">
<h4 id="breaking-changes-0-13-0">Breaking changes<a class="anchor" aria-label="anchor" href="#breaking-changes-0-13-0"></a></h4>
<ul><li>
<code>launch_app()</code> was replaced by <code>erahumed:::launch_dss_v0()</code>, which gives access to the old GUI (this is a provisional measure which is not guaranteed to be maintained in future).</li>
</ul></div>
<div class="section level4">
<h4 id="other-api-changes-0-13-0">Other API changes<a class="anchor" aria-label="anchor" href="#other-api-changes-0-13-0"></a></h4>
<ul><li>
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> methods now always succeed with their default argument. Methods that require the specification of a cluster now choose the first one available in the output <code>data.frame</code>, whenever the <code>cluster_id</code> argument is missing.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.12.5" id="erahumed-0125">erahumed 0.12.5<a class="anchor" aria-label="anchor" href="#erahumed-0125"></a></h2>
<div class="section level4">
<h4 id="new-features-0-12-5">New features<a class="anchor" aria-label="anchor" href="#new-features-0-12-5"></a></h4>
<ul><li>New function <code><a href="../reference/erahumed_docs.html">erahumed_docs()</a></code> to interact with the ERAHUMED documentation as an R object. Although this is part of the exported namespace, it is mainly added for future internal use.</li>
</ul></div>
<div class="section level4">
<h4 id="gui-0-12-5">GUI<a class="anchor" aria-label="anchor" href="#gui-0-12-5"></a></h4>
<ul><li><p>Data input modules are now able to handle Excel as well as CSV input and output (<a href="https://github.com/erahumed/erahumed/issues/215" class="external-link">#215</a>).</p></li>
<li><p>Improved error messages of data input modules when the uploaded file does not have the correct column structure.</p></li>
</ul></div>
<div class="section level4">
<h4 id="documentation-0-12-5">Documentation<a class="anchor" aria-label="anchor" href="#documentation-0-12-5"></a></h4>
<ul><li>Added tooltips with parameters descriptions to the <a href="https://erahumed.github.io/erahumed/articles/pipeline-scheme.html">pipeline-scheme vignette</a>.</li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-12-5">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-12-5"></a></h4>
<ul><li><p>Shiny modules associated with the various model layers no longer receive <code>erahumed_simulation</code> objects, but rather directly operate with <code>erahumed_layer</code> objects. This makes code logic more transparent, both for the modules themselves as well as for the main application.</p></li>
<li><p>The documentation of layer parameters is now generated programmatically and can be read at run-time through the new helper <code><a href="../reference/erahumed_docs.html">erahumed_docs()</a></code>.</p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.12.4" id="erahumed-0124">erahumed 0.12.4<a class="anchor" aria-label="anchor" href="#erahumed-0124"></a></h2>
<div class="section level4">
<h4 id="visualization-0-12-4">Visualization<a class="anchor" aria-label="anchor" href="#visualization-0-12-4"></a></h4>
<ul><li>Switched to the <a href="https://github.com/rstudio/dygraphs" class="external-link">dygraphs</a> plotting library for all built-in time-series plots, in particular those featured in the Shiny app (<a href="https://github.com/erahumed/erahumed/issues/181" class="external-link">#181</a>).</li>
</ul></div>
<div class="section level4">
<h4 id="gui-0-12-4">GUI<a class="anchor" aria-label="anchor" href="#gui-0-12-4"></a></h4>
<ul><li>CSV file upload now triggers informative errors when the uploaded file does not have the expected format (<a href="https://github.com/erahumed/erahumed/issues/208" class="external-link">#208</a>).</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.12.3" id="erahumed-0123">erahumed 0.12.3<a class="anchor" aria-label="anchor" href="#erahumed-0123"></a></h2>
<div class="section level4">
<h4 id="visualization-0-12-3">Visualization<a class="anchor" aria-label="anchor" href="#visualization-0-12-3"></a></h4>
<ul><li>Graphical improvements to the Albufera map visualization (<a href="https://github.com/erahumed/erahumed/issues/104" class="external-link">#104</a>).</li>
</ul></div>
<div class="section level4">
<h4 id="new-features-0-12-3">New features<a class="anchor" aria-label="anchor" href="#new-features-0-12-3"></a></h4>
<ul><li>New function <code><a href="../reference/hydrogeo_components.html">info_ditches()</a></code> that returns information on the ditches of the Albufera Natural Park considered in modeling.</li>
</ul></div>
<div class="section level4">
<h4 id="documentation-0-12-3">Documentation<a class="anchor" aria-label="anchor" href="#documentation-0-12-3"></a></h4>
<ul><li><p>Added website badge and other minor improvements to README. (<a href="https://github.com/erahumed/erahumed/issues/204" class="external-link">#204</a>)</p></li>
<li><p>Added links to the <a href="https://erahumed.github.io/erahumed/articles/pipeline-scheme.html"><code>pipeline-scheme</code> vignette</a> in various places of the documentation (<a href="https://github.com/erahumed/erahumed/issues/193" class="external-link">#193</a>).</p></li>
</ul></div>
<div class="section level4">
<h4 id="dependencies-0-12-3">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies-0-12-3"></a></h4>
<ul><li>Dropped dependency from <code>{randomcoloR}</code> after the fixes of <a href="https://github.com/erahumed/erahumed/issues/104" class="external-link">#104</a>.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.12.2" id="erahumed-0122">erahumed 0.12.2<a class="anchor" aria-label="anchor" href="#erahumed-0122"></a></h2>
<div class="section level4">
<h4 id="api-changes-0-12-2">API changes<a class="anchor" aria-label="anchor" href="#api-changes-0-12-2"></a></h4>
<ul><li><p>The <code>'seed'</code> parameter moves from <code>setup_hbp()</code> to <code>setup_inp()</code>.</p></li>
<li><p>Former informative function <code>clusters()</code> was renamed <code><a href="../reference/hydrogeo_components.html">info_clusters()</a></code> <a href="https://github.com/erahumed/erahumed/issues/189" class="external-link">#189</a>.</p></li>
<li><p>Former informative functions <code>chemicals()</code> and <code>chemical_properties()</code><br>
were replaced by a single function <code><a href="../reference/info_chemicals.html">info_chemicals()</a></code>, that returns a named list (<a href="https://github.com/erahumed/erahumed/issues/189" class="external-link">#189</a> and <a href="https://github.com/erahumed/erahumed/issues/190" class="external-link">#190</a>).</p></li>
</ul></div>
<div class="section level4">
<h4 id="gui-changes-0-12-2">GUI changes<a class="anchor" aria-label="anchor" href="#gui-changes-0-12-2"></a></h4>
<ul><li><p>The Albufera map in the UI is again showing the (randomly generated9 cluster variety (<a href="https://github.com/erahumed/erahumed/issues/191" class="external-link">#191</a>).</p></li>
<li><p>The “Setup” panel of the INP layer gets three new numeric inputs to setup <code>variety_prop</code> (<a href="https://github.com/erahumed/erahumed/issues/199" class="external-link">#199</a>).</p></li>
<li><p>The “Setup” panel of the HBA layer gets four new numeric inputs to setup the <code>storage_curve</code> and <code>petp_function</code> parameters (<a href="https://github.com/erahumed/erahumed/issues/203" class="external-link">#203</a>).</p></li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-12-2">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-12-2"></a></h4>
<ul><li><p>Important simplifications in the logic of layer computation functions. Former <code>compute_*_bare()</code> functions no longer exist, in favor of new <code>compute_*()</code> functions returning simulation-type objects. Function lookup by name (formerly performed by internal helper <code>get_erahumed_fun()</code>) is now avoided, in favor of more transparent and simpler R code in <code>compute_layer()</code>that employs a switch statement.</p></li>
<li><p>Refactor of layer objects internal structure: now layer S3 objects have an <code>aux</code> element that stores intermediate results of layer computations.</p></li>
<li><p>Cluster varieties are now stored in the <code>aux</code> list of the INP layer.</p></li>
<li><p><code>plot_albufera_clusters()</code> gets a new <code>cluster_variety_map</code> argument.</p></li>
<li><p><code>test_sim_small()</code> and <code>test_sim_large()</code> helpers get new arguments <code>seed</code> (seed for simulation) and <code>force</code> (whether to force recomputation of object).</p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.12.1" id="erahumed-0121">erahumed 0.12.1<a class="anchor" aria-label="anchor" href="#erahumed-0121"></a></h2>
<div class="section level4">
<h4 id="gui-0-12-1">GUI<a class="anchor" aria-label="anchor" href="#gui-0-12-1"></a></h4>
<p>The app has a brand new GUI based on <a href="http://rstudio.github.io/shinydashboard/" class="external-link">shinydashboard</a>. The refactor is partially based on work from PR <a href="https://github.com/erahumed/erahumed/issues/198" class="external-link">#198</a>, which was proposing a tentative layout with a “floating” map, in an attempt to address <a href="https://github.com/erahumed/erahumed/issues/183" class="external-link">#183</a> and <a href="https://github.com/erahumed/erahumed/issues/195" class="external-link">#195</a>. The final version closes issues <a href="https://github.com/erahumed/erahumed/issues/183" class="external-link">#183</a>, <a href="https://github.com/erahumed/erahumed/issues/195" class="external-link">#195</a> and <a href="https://github.com/erahumed/erahumed/issues/197" class="external-link">#197</a>.</p>
</div>
<div class="section level4">
<h4 id="documentation-0-12-1">Documentation<a class="anchor" aria-label="anchor" href="#documentation-0-12-1"></a></h4>
<ul><li>New vignette showing the simulation pipeline as DAG (<a href="https://github.com/erahumed/erahumed/issues/182" class="external-link">#182</a>).</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.12.0" id="erahumed-0120">erahumed 0.12.0<a class="anchor" aria-label="anchor" href="#erahumed-0120"></a></h2>
<div class="section level4">
<h4 id="algorithms-changes-0-12-0">Algorithms changes<a class="anchor" aria-label="anchor" href="#algorithms-changes-0-12-0"></a></h4>
<ul><li>The variety of clusters is no longer fixed data, but is rather generated randomly in each simulation, with a fixed proportion of the Albufera’s total surface allocated to Bomba/Sendra/Clearfield varieties. The relevant parameter is the new <code>variety_prop</code> argument of <code>setup_inp()</code> (see below), while the actual computation currently happens at the level of the HBP layer.</li>
</ul></div>
<div class="section level4">
<h4 id="api-changes-0-12-0">API changes<a class="anchor" aria-label="anchor" href="#api-changes-0-12-0"></a></h4>
<ul><li>Removed <code>albufera_clusters</code> and <code>albufera_cluster_geometries</code> data-sets (<a href="https://github.com/erahumed/erahumed/issues/47" class="external-link">#47</a>).</li>
<li>Removed <code>clusters_df</code> argument from <code>setup_hbp()</code>.</li>
<li>New argument <code>variety_prop</code> in <code>setup_inp()</code>, to set the proportion of the Albufera’s Natural Park surface allocated for the three rice varieties (J. Sendra, Bomba, and Clearfield) (<a href="https://github.com/erahumed/erahumed/issues/185" class="external-link">#185</a>).</li>
</ul></div>
<div class="section level4">
<h4 id="gui-0-12-0">GUI<a class="anchor" aria-label="anchor" href="#gui-0-12-0"></a></h4>
<ul><li>Shiny app title now includes the version of the package (<a href="https://github.com/erahumed/erahumed/issues/174" class="external-link">#174</a>).</li>
<li>Added favicon to app (<a href="https://github.com/erahumed/erahumed/issues/178" class="external-link">#178</a>).</li>
<li>Loading UI element now show a loading animation (<a href="https://github.com/erahumed/erahumed/issues/175" class="external-link">#175</a>).</li>
<li>Removed unused “seed” inputs from CA and CT layers Shiny modules (<a href="https://github.com/erahumed/erahumed/issues/177" class="external-link">#177</a>).</li>
</ul></div>
<div class="section level4">
<h4 id="visualizations-0-12-0">Visualizations<a class="anchor" aria-label="anchor" href="#visualizations-0-12-0"></a></h4>
<ul><li>CA: changed line styles of applications to dashed (<a href="https://github.com/erahumed/erahumed/issues/176" class="external-link">#176</a>).</li>
</ul></div>
<div class="section level4">
<h4 id="dependencies-0-12-0">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies-0-12-0"></a></h4>
<ul><li>Added Imports: <code>base64enc</code> and <code>utils</code>.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.11.4" id="erahumed-0114">erahumed 0.11.4<a class="anchor" aria-label="anchor" href="#erahumed-0114"></a></h2>
<div class="section level4">
<h4 id="bug-fixes-0-11-4">Bug fixes<a class="anchor" aria-label="anchor" href="#bug-fixes-0-11-4"></a></h4>
<ul><li>Fix regression that was making the app crash if called without loading the package, caused by unreferenced call to the <code>albufera_clusters</code> dataset.</li>
</ul></div>
<div class="section level4">
<h4 id="gui-0-11-4">GUI<a class="anchor" aria-label="anchor" href="#gui-0-11-4"></a></h4>
<ul><li><p>Data-frames displayed in the INP Shiny module show up to 4 significant digits (<a href="https://github.com/erahumed/erahumed/issues/164" class="external-link">#164</a>).</p></li>
<li><p>The “Lake Level” variable for the HBA layer plots no longer exists, since the resulting plot was identical to the “Lake Volume” plot, up to an affine transformation of the Y-axis (<a href="https://github.com/erahumed/erahumed/issues/101" class="external-link">#101</a>).</p></li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-11-4">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-11-4"></a></h4>
<ul><li><p>Data generation scripts in <code>data-raw/</code> now use ‘renv::use()’ directive at the beginning of code to ensure reproducibility (<a href="https://github.com/erahumed/erahumed/issues/35" class="external-link">#35</a>)</p></li>
<li><p>Server function of CSV input gets a new argument <code>sig_digits</code>, set by default to <code>4</code> (<a href="https://github.com/erahumed/erahumed/issues/164" class="external-link">#164</a>).</p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.11.3" id="erahumed-0113">erahumed 0.11.3<a class="anchor" aria-label="anchor" href="#erahumed-0113"></a></h2>
<div class="section level4">
<h4 id="gui-0-11-3">GUI<a class="anchor" aria-label="anchor" href="#gui-0-11-3"></a></h4>
<ul><li>The selected cluster is now synced across the HBP, CA and CT layers of the Shiny interface.</li>
</ul></div>
<div class="section level4">
<h4 id="documentation-0-11-3">Documentation<a class="anchor" aria-label="anchor" href="#documentation-0-11-3"></a></h4>
<ul><li>Documented source of <code>albufera_weather</code> dataset.</li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-11-3">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-11-3"></a></h4>
<ul><li><p>HBP, CA and CT Shiny submodules now share a common leaflet map reactive object, that thus does not need to be computed several times (<a href="https://github.com/erahumed/erahumed/issues/131" class="external-link">#131</a>).</p></li>
<li><p>Fixed broken functionality of <code>assert_data.frame(extends = FALSE)</code> (the <code>extends</code> argument was being bypassed).</p></li>
<li><p>Fix broken <code>summary.erahumed_simulation_layer()</code> method.</p></li>
<li><p>Removed low-level creator for <code>erahumed_simulation</code> class objects (<em>i.e.</em> <code>new_erahumed_simulation()</code>).</p></li>
<li><p>Remove unused <code>max = 100</code> argument of <code>print.erahumed_simulation()</code>.</p></li>
</ul></div>
<div class="section level4">
<h4 id="testing-0-11-3">Testing<a class="anchor" aria-label="anchor" href="#testing-0-11-3"></a></h4>
<ul><li>Added snapshot tests for plot methods of ERAHUMED layers (<a href="https://github.com/erahumed/erahumed/issues/149" class="external-link">#149</a>).</li>
<li>Added basic server tests for all shiny modules (<a href="https://github.com/erahumed/erahumed/issues/150" class="external-link">#150</a>).</li>
<li>Added basic UI no-error tests for all shiny modules.</li>
<li>Testing of <code><a href="../reference/run_simulation.html">run_simulation()</a></code>.</li>
<li>Test that setting seed in <code>setup_hbp()</code> ensures reproducibility, and that different seeds give rise to different outputs.</li>
<li>Testing corner cases of assertions.</li>
<li>Testing of <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> and <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> S3 methods for <code>erahumed_simulation</code> and <code>erahumed_simulation_layer</code> S3 classes.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.11.2" id="erahumed-0112">erahumed 0.11.2<a class="anchor" aria-label="anchor" href="#erahumed-0112"></a></h2>
<div class="section level4">
<h4 id="new-features-0-11-2">New features<a class="anchor" aria-label="anchor" href="#new-features-0-11-2"></a></h4>
<ul><li>
<code>setup_hbp()</code> receives an additional <code>seed</code> argument, which sets the seed used by the underlying algorithm (default to <code>840</code>). (<a href="https://github.com/erahumed/erahumed/issues/153" class="external-link">#153</a>)</li>
</ul></div>
<div class="section level4">
<h4 id="minor-apigui-changes-0-11-2">Minor API/GUI changes<a class="anchor" aria-label="anchor" href="#minor-apigui-changes-0-11-2"></a></h4>
<ul><li><p>All modules of the GUI now have a “Download Data” button that allows to download the output data.frame (in CSV format) of the corresponding simulation layer (<a href="https://github.com/erahumed/erahumed/issues/144" class="external-link">#144</a>).</p></li>
<li><p>“Observed/Imputed Data” labels in the legend of HBA plots become “Source: Observed/Imputed Outflow Data”. (<a href="https://github.com/erahumed/erahumed/issues/100" class="external-link">#100</a>)</p></li>
<li><p><code>outflow_extra</code> column HBA output becomes <code>outflow_recirculation</code>. Correspondingly, the label for this variable in the GUI becomes <code>"Water Recirculation Outflow"</code>. (<a href="https://github.com/erahumed/erahumed/issues/102" class="external-link">#102</a>)</p></li>
</ul></div>
<div class="section level4">
<h4 id="documentation-0-11-2">Documentation<a class="anchor" aria-label="anchor" href="#documentation-0-11-2"></a></h4>
<ul><li><p><code>?hbp</code> now documents the columns of the output data.frame of the HBP layer.</p></li>
<li><p>The main package vignette, as well as the <code>?get_layer()</code> documentation page now mention the built-in plotting methods of <a href="https://github.com/erahumed/erahumed" class="external-link">erahumed</a> (<a href="https://github.com/erahumed/erahumed/issues/159" class="external-link">#159</a>).</p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.11.1" id="erahumed-0111">erahumed 0.11.1<a class="anchor" aria-label="anchor" href="#erahumed-0111"></a></h2>
<div class="section level4">
<h4 id="algorithm-0-11-1">Algorithm<a class="anchor" aria-label="anchor" href="#algorithm-0-11-1"></a></h4>
<ul><li><p>The water-sediment partition coefficient of chemicals is now computed as <code>kd = koc * foc</code>, where <code>koc</code> is the carbon-water partition coefficient, and <code>foc</code> is the fraction of organic content in soil (<a href="https://github.com/erahumed/erahumed/issues/105" class="external-link">#105</a>). Correspondingly, <code>setup_ct()</code> gets a new argument <code>foc</code>, with default value <code>foc = 0.17</code>.</p></li>
<li><p>The internal data-set of physico-chemical parameters used by the CT layer was thoroughly reviewed (<a href="https://github.com/erahumed/erahumed/issues/123" class="external-link">#123</a>), with sizable corrections to some parameters. In particular, <code>kd</code> values have been substituted by <code>koc</code> values (see previous point).</p></li>
</ul></div>
<div class="section level4">
<h4 id="api-changes-0-11-1">API changes<a class="anchor" aria-label="anchor" href="#api-changes-0-11-1"></a></h4>
<ul><li>
<code>get_layer()</code> now throws an error if the <code>layer</code> argument is not specified, whereas it would previously return the <code>"inp"</code> layer.</li>
</ul></div>
<div class="section level4">
<h4 id="new-features-0-11-1">New features<a class="anchor" aria-label="anchor" href="#new-features-0-11-1"></a></h4>
<ul><li>New helper <code>erahumed_layers()</code> that returns the list of ERAHUMED simulation layers.</li>
<li>New helpers <code>chemicals()</code> and <code>chemical_properties()</code> providing information on supported chemicals.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.11.0" id="erahumed-0110">erahumed 0.11.0<a class="anchor" aria-label="anchor" href="#erahumed-0110"></a></h2>
<div class="section level4">
<h4 id="api-changes-0-11-0">API changes<a class="anchor" aria-label="anchor" href="#api-changes-0-11-0"></a></h4>
<p>Former <code>erahumed_model()</code> has been substituted by <code><a href="../reference/erahumed_simulation.html">erahumed_simulation()</a></code>. Beyond the terminology change, the main difference lies in the fact that simulation setup and computation are handled separately in the new implementation. The best introduction to the new API is probably the fresh new vignette, <a href="https://erahumed.github.io/erahumed/articles/erahumed-workflow.html">Simulation workflow</a>.</p>
<p>As a further terminology change, what we previously referred to as a “model component” becomes a “simulation layer”. Apart from the obvious changes in function names, this does not imply any conceptual or API change.</p>
<p>Currently, the exported namespace of the package consists of:</p>
<ul><li>
<strong>Datasets.</strong> No changes.</li>
<li>
<strong>Layer extractors.</strong> <code>get_layer()</code>, <code>get_layer_output()</code>, <code>get_layer_parameters()</code>.</li>
<li>
<strong>Simulation initialization.</strong> <code><a href="../reference/erahumed_simulation.html">erahumed_simulation()</a></code>.</li>
<li>
<strong>Simulation setup.</strong> <code>setup_inp()</code>, <code>setup_hba()</code>, <code>setup_hbp()</code>, <code>setup_ca()</code>, <code>setup_ct()</code>.</li>
<li>
<strong>Simulation execution.</strong> <code><a href="../reference/run_simulation.html">run_simulation()</a></code>.</li>
<li>
<strong>Shiny App.</strong> No changes.</li>
</ul></div>
<div class="section level4">
<h4 id="data-0-11-0">Data<a class="anchor" aria-label="anchor" href="#data-0-11-0"></a></h4>
<ul><li>Reduced the number of significant digits in the default P-ETP function used by the HBA component, so as to match the relative accuracy of the storage curve extracted from the cited CHJ report (<a href="https://github.com/erahumed/erahumed/issues/95" class="external-link">#95</a>).</li>
</ul></div>
<div class="section level4">
<h4 id="documentation-0-11-0">Documentation<a class="anchor" aria-label="anchor" href="#documentation-0-11-0"></a></h4>
<ul><li><p>New package vignette: <a href="https://erahumed.github.io/erahumed/articles/erahumed-workflow.html">Simulation workflow</a>.</p></li>
<li><p>Added information and references in the documentation page of <code>albufera_clusters</code> and <code>albufera_cluster_geometries</code> datasets (<a href="https://github.com/erahumed/erahumed/issues/52" class="external-link">#52</a>).</p></li>
<li><p>Citation of Martínez-Megías et al. (2023) in <code><a href="../reference/albufera_management.html">?albufera_management</a></code> changed to APA style.</p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.10.0" id="erahumed-0100">erahumed 0.10.0<a class="anchor" aria-label="anchor" href="#erahumed-0100"></a></h2>
<div class="section level4">
<h4 id="algorithm-0-10-0">Algorithm<a class="anchor" aria-label="anchor" href="#algorithm-0-10-0"></a></h4>
<p>In previous implementations of HBP, whenever there was a positive difference between the ditch’s outflow, and the sum of the clusters ideal outflows, this was compensated by sharing it uniformly among clusters (and adding equal amounts of irrigation to these). We stop doing this and, instead, allow for the sum of cluster outflows to be less than the corresponding ditch outflow. If we assume constant ditch water levels, this amounts to assuming that the difference comes from an independent source.</p>
</div>
<div class="section level4">
<h4 id="visualization-0-10-0">Visualization<a class="anchor" aria-label="anchor" href="#visualization-0-10-0"></a></h4>
<ul><li>HBP model component plot method: the height variable plotted is now <code>height_sod_cm</code>, rather than <code>height_eod_cm</code> as before. This is done in order to simplify visual comparisons between the plots for HBP and CT model components.</li>
</ul></div>
<div class="section level4">
<h4 id="new-features-0-10-0">New features<a class="anchor" aria-label="anchor" href="#new-features-0-10-0"></a></h4>
<ul><li>HBP model component output now also includes an <code>height_sod_cm</code> column, representing the cluster’s water level at “start-of-day”.</li>
</ul></div>
<div class="section level4">
<h4 id="breaking-changes-in-api-0-10-0">Breaking changes in API<a class="anchor" aria-label="anchor" href="#breaking-changes-in-api-0-10-0"></a></h4>
<ul><li>
<p>Variable names refactors:</p>
<ul><li><p>Former <code>irrigation</code>, <code>draining</code> and <code>height_cm</code> columns of <code>albufera_management</code> become <code>ideal_irrigation</code>, <code>ideal_draining</code> and <code>ideal_height_eod_cm</code>.</p></li>
<li><p>Former <code>real_irrigation</code>, <code>real_draining</code> and <code>real_height_cm</code> columns of the HBP component output become <code>irrigation</code>, <code>draining</code> and <code>height_eod_cm</code>.</p></li>
<li><p>Former <code>real_inflow_cm/m3_s</code> and <code>real_outflow_cm/m3_s</code> are renamed <code>inflow_cm/m3_s</code> and <code>outflow_cm/m3_s</code>, respectively.</p></li>
</ul></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.9.0" id="erahumed-090">erahumed 0.9.0<a class="anchor" aria-label="anchor" href="#erahumed-090"></a></h2>
<div class="section level4">
<h4 id="algorithm-0-9-0">Algorithm<a class="anchor" aria-label="anchor" href="#algorithm-0-9-0"></a></h4>
<ul><li>Major improvements to the ODE solution method underlying the CT model component. Physico-chemical processes are altogether treated exactly, by solving the corresponding linear ODE obtained by removing the terms corresponding to outflow, chemical applications and solubility (the latter processes are calculated in a second stage, with the masses obtained after evolving for a time step according to the linear ODE system). Although this is still suboptimal from the POV that the outflow process is considered as <em>instantaneous</em> and <em>simultaneous to application</em> (see <a href="https://github.com/erahumed/erahumed/issues/146" class="external-link">#146</a>), this already gives rise to much more realistic dynamics, especially in relation to the diffusion process between water and sediment.</li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-9-0">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-9-0"></a></h4>
<ul><li>Added <code>ppm_to_kg_m3()</code> and <code>ppm_to_g_cm3()</code> internal helpers.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.8.1" id="erahumed-081">erahumed 0.8.1<a class="anchor" aria-label="anchor" href="#erahumed-081"></a></h2>
<div class="section level4">
<h4 id="algorithm-0-8-1">Algorithm<a class="anchor" aria-label="anchor" href="#algorithm-0-8-1"></a></h4>
<ul><li>Fixed various errors in the internal data-set providing physico-chemical parameters for CT model layer. This is a first effort to address (<a href="https://github.com/erahumed/erahumed/issues/123" class="external-link">#123</a>), which however requires further review.</li>
</ul></div>
<div class="section level4">
<h4 id="new-features-0-8-1">New features<a class="anchor" aria-label="anchor" href="#new-features-0-8-1"></a></h4>
<ul><li><p>The CT component returns not only masses, but also concentrations (water, sediment and outflow densities).</p></li>
<li><p>Density plots are made available, in the Shiny interface as well as in the R API, through the new argument <code>plot.ct_erahumed(variable)</code>.</p></li>
</ul></div>
<div class="section level4">
<h4 id="user-visible-changes-0-8-1">User visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-0-8-1"></a></h4>
<ul><li>The output of the CT model component is now in a “long” format, in which <code>chemical</code> is a column, and masses are reported in the <code>mf</code>, <code>mw</code> and <code>ms</code> columns.</li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-8-1">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-8-1"></a></h4>
<ul><li>“Bare” references to the <code>$output</code> element of model components in internal code have been substituted, using the <code>component_output()</code> extractor instead (<a href="https://github.com/erahumed/erahumed/issues/99" class="external-link">#99</a>).</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.8.0" id="erahumed-080">erahumed 0.8.0<a class="anchor" aria-label="anchor" href="#erahumed-080"></a></h2>
<div class="section level4">
<h4 id="breaking-changes-0-8-0">Breaking changes<a class="anchor" aria-label="anchor" href="#breaking-changes-0-8-0"></a></h4>
<ul><li>Nomenclature change: <code>petp_df</code> (argument of <code>compute_inp()</code> as well as “parameter” for the INP component) becomes <code>weather_df</code>. Correspondingly, the <code>albufera_petp</code> dataset is renamed <code>albufera_weather</code>. These changes come as a consequence of <a href="https://github.com/erahumed/erahumed/issues/20" class="external-link">#20</a> (see below.)</li>
</ul></div>
<div class="section level4">
<h4 id="new-features-0-8-0">New features<a class="anchor" aria-label="anchor" href="#new-features-0-8-0"></a></h4>
<ul><li><p>Data: added temperature daily data (minimum, maximum and average) to the <code>albufera_weather</code> dataset (formerly known as <code>albufera_petp</code>), closing <a href="https://github.com/erahumed/erahumed/issues/20" class="external-link">#20</a>.</p></li>
<li><p>Introduced simplified temperature dependence in the algorithm for the CT model component (we simply plug in the average daily temperature in the Arrhenius equation for the degradation constant).</p></li>
<li><p>HBP: improved plotting method (<code>plot.erahumed_hbp</code>), which now provides a double plot of cluster water levels (on top) and water flows (on bottom).</p></li>
<li><p>CA: added a minimalistic Shiny interface to display the results of chemical applications in the form of time series for individual clusters.</p></li>
<li><p>CT: added plotting method (see <code>?plot.erahumed_ct</code>) and corresponding Shiny interface.</p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.7.3" id="erahumed-073">erahumed 0.7.3<a class="anchor" aria-label="anchor" href="#erahumed-073"></a></h2>
<div class="section level4">
<h4 id="algorithm-changes-0-7-3">Algorithm changes<a class="anchor" aria-label="anchor" href="#algorithm-changes-0-7-3"></a></h4>
<ul><li>CT: the multiplier for the sediment to water diffusion term was thresholded to one, as this number should always be a positive fraction of unity. In any case, multipliers larger than one are probably being created by issues in the pesticide parameters (<em>e.g.</em> unit errors) that are currently being addressed, so that the threshold should become unnecessary in the long run.</li>
</ul></div>
<div class="section level4">
<h4 id="breaking-changes-0-7-3">Breaking changes<a class="anchor" aria-label="anchor" href="#breaking-changes-0-7-3"></a></h4>
<ul><li>Renamed arguments of <code>compute_ct()</code> by making units explicit (<em>e.g.</em> <code>css</code> becomes <code>css_ppm</code>).</li>
</ul></div>
<div class="section level4">
<h4 id="bug-fixes-0-7-3">Bug fixes<a class="anchor" aria-label="anchor" href="#bug-fixes-0-7-3"></a></h4>
<ul><li>Fixed inhomogeneous term in the evolution equation for <code>ms[t]</code> (due to a typo ms was wrongly getting added the mass applied on foliage).</li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-7-3">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-7-3"></a></h4>
<ul><li><p>Re-enabled tests that were momentarily disabled after the refactor of v0.6.0. These consisted of a few tests on the argument checking performed by <code>compute_hbp()</code>, plus a snapshot test (skipped on CI) on the initial Shiny values.</p></li>
<li><p>Various simplifications in the low-level code of the CT model components.</p></li>
<li><p>Basic unit tests for the CT component functions.</p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.7.2" id="erahumed-072">erahumed 0.7.2<a class="anchor" aria-label="anchor" href="#erahumed-072"></a></h2>
<div class="section level4">
<h4 id="new-features-0-7-2">New features<a class="anchor" aria-label="anchor" href="#new-features-0-7-2"></a></h4>
<ul><li>CT model component now uses actual cluster and chemical parameters in the evolution equations (whereas it was previously using dummy values of the expected order of magnitude).</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.7.1" id="erahumed-071">erahumed 0.7.1<a class="anchor" aria-label="anchor" href="#erahumed-071"></a></h2>
<div class="section level4">
<h4 id="bug-fixes-0-7-1">Bug fixes<a class="anchor" aria-label="anchor" href="#bug-fixes-0-7-1"></a></h4>
<ul><li>Fixes a regression introduced in v0.7.0 that introduced an error in the computation of rain and evaporation water volumes (see <a href="https://github.com/erahumed/erahumed/issues/115" class="external-link">#115</a> and <a href="https://github.com/erahumed/erahumed/issues/116" class="external-link">#116</a>).</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.7.0" id="erahumed-070">erahumed 0.7.0<a class="anchor" aria-label="anchor" href="#erahumed-070"></a></h2>
<div class="section level4">
<h4 id="new-features-0-7-0">New features<a class="anchor" aria-label="anchor" href="#new-features-0-7-0"></a></h4>
<ul><li>Experimental release of CT model component, with new functions <code>compute_ct()</code> and <code>ct()</code> (close <a href="https://github.com/erahumed/erahumed/issues/92" class="external-link">#92</a>).</li>
</ul></div>
<div class="section level4">
<h4 id="breaking-changes-0-7-0">Breaking changes<a class="anchor" aria-label="anchor" href="#breaking-changes-0-7-0"></a></h4>
<ul><li><p>Removed helpers <code>linear_petp_surface()</code> and <code>linear_storage_curve()</code>. These were substituted by simple lambdas in the specification of defaults arguments of <code>compute_hba()</code>, which seems to be a bit more transparent (<a href="https://github.com/erahumed/erahumed/issues/96" class="external-link">#96</a>).</p></li>
<li><p><code>compute_hba()</code> argument name change: <code>petp_surface</code> becomes <code>petp_function</code>.</p></li>
</ul></div>
<div class="section level4">
<h4 id="improvements-0-7-0">Improvements<a class="anchor" aria-label="anchor" href="#improvements-0-7-0"></a></h4>
<ul><li>Set amounts (kg_per_ha) in albufera_ca_schedules builtin dataset (close <a href="https://github.com/erahumed/erahumed/issues/84" class="external-link">#84</a>).</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.6.0" id="erahumed-060">erahumed 0.6.0<a class="anchor" aria-label="anchor" href="#erahumed-060"></a></h2>
<div class="section level4">
<h4 id="general-info-0-6-0">General info<a class="anchor" aria-label="anchor" href="#general-info-0-6-0"></a></h4>
<p>This version provides an important refactor of the software’s modeling interface, consolidating the concept of ERAHUMED model and model components.</p>
<p>The refactor necessarily breaks existing code that relied on the initial provisional interface. A basic example illustrating how to use the new modeling interface is provided by the README update that accompanies the new version.</p>
</div>
<div class="section level4">
<h4 id="breaking-changes-0-6-0">Breaking changes<a class="anchor" aria-label="anchor" href="#breaking-changes-0-6-0"></a></h4>
<ul><li>Essential refactor of modeling API, as mentioned above.</li>
<li>The HBP model component (formerly known as “local hydrological balance”) does not allow anymore the specification of <code>date_min/max</code> arguments; the date range is univocally determined by the data fed to the INP model component.</li>
<li>Removed bold from printing methods, which was not correctly rendering in Github flavored markdown.</li>
<li>Renamed the HBP admissible plot types (value of <code>type</code> parameter to <code>plot.erahumed_hbp()</code>), from <code>"cluster_levels"</code> and <code>"map"</code> to <code>"cluster_view"</code> and <code>"map_view"</code>.</li>
<li>Removed <code>height_thresh_cm</code> argument from arguments of CA component high level functions (<code>compute_ca()</code> in the present version), to move it down to the<br>
corresponding functions of the HBP component. This ensures, in particular, that a common value is used across the two different model components.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.5.1" id="erahumed-051">erahumed 0.5.1<a class="anchor" aria-label="anchor" href="#erahumed-051"></a></h2>
<div class="section level4">
<h4 id="documentation-0-5-1">Documentation<a class="anchor" aria-label="anchor" href="#documentation-0-5-1"></a></h4>
<ul><li>Emails and ORCID of additional package authors were added to the package metadata.</li>
</ul></div>
<div class="section level4">
<h4 id="bug-fixes-0-5-1">Bug fixes<a class="anchor" aria-label="anchor" href="#bug-fixes-0-5-1"></a></h4>
<ul><li>Fix bug that was causing errors in the plots of Perellonet, Perelló and Pujol outflows in the Shiny interface (<a href="https://github.com/erahumed/erahumed/issues/90" class="external-link">#90</a>).</li>
</ul></div>
<div class="section level4">
<h4 id="other-0-5-1">Other<a class="anchor" aria-label="anchor" href="#other-0-5-1"></a></h4>
<ul><li>The package has a new website, available at <a href="https://erahumed.github.io/erahumed/" class="uri">https://erahumed.github.io/erahumed/</a>.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.5.0" id="erahumed-050">erahumed 0.5.0<a class="anchor" aria-label="anchor" href="#erahumed-050"></a></h2>
<div class="section level4">
<h4 id="breaking-changes-0-5-0">Breaking changes<a class="anchor" aria-label="anchor" href="#breaking-changes-0-5-0"></a></h4>
<ul><li><p>Names of columns representing outflows in <code>albufera_outflows</code> have been prepended with <code>outflow_</code>.</p></li>
<li><p>Logic of <code>albufera_hb_global()</code> has been improved in such a way that the outflow columns are automatically recognized from the input data.frame, and do not need to be exactly <code>"pujol"</code>, <code>"perellonet"</code> and `<code>"perello"</code>, as before.</p></li>
<li><p>Former <code>irrigation</code> and <code>draining</code> columns from the output data.frame of <code>albufera_hb_local()</code> became <code>ideal_irrigation</code> and <code>ideal_draining</code>, to better reflect that these correspond to the originally scheduled irrigation and draining plans. In addition, new columns <code>real_irrigation</code> and <code>real_draining</code> were added to the data.frame, which provide the actual irrigation and draining plans followed, modified by the plan delay.</p></li>
</ul></div>
<div class="section level4">
<h4 id="new-features-0-5-0">New features<a class="anchor" aria-label="anchor" href="#new-features-0-5-0"></a></h4>
<ul><li>Visualizations of the “extra outflow” variable have been added to the global hydrological balance module of the Shiny dashboard.</li>
</ul></div>
<div class="section level4">
<h4 id="bug-fixes-0-5-0">Bug fixes<a class="anchor" aria-label="anchor" href="#bug-fixes-0-5-0"></a></h4>
<ul><li>Fixed broken functionality of ‘height_thresh_cm’ argument (<a href="https://github.com/erahumed/erahumed/issues/85" class="external-link">#85</a>).</li>
<li>Correct bug that was causing the wrong delay being applied to <code>seed_day</code> in the <code>ca_choose_application_day_index()</code> helper, building block of <code>ca()</code>.</li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-5-0">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-5-0"></a></h4>
<ul><li>Unit testing of CA model block (<a href="https://github.com/erahumed/erahumed/issues/77" class="external-link">#77</a>).</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.4.1" id="erahumed-041">erahumed 0.4.1<a class="anchor" aria-label="anchor" href="#erahumed-041"></a></h2>
<div class="section level4">
<h4 id="new-features-0-4-1">New features<a class="anchor" aria-label="anchor" href="#new-features-0-4-1"></a></h4>
<ul><li>First draft of <code>plot.erahumed_ca()</code> (“cluster view”).</li>
</ul></div>
<div class="section level4">
<h4 id="user-visible-changes-0-4-1">User visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-0-4-1"></a></h4>
<ul><li><p>The default for the <code>height_thresh_cm</code> parameter of <code>ca()</code> has been changed from <code>2.5</code> to <code>2</code>.</p></li>
<li><p>The <code>albufera_management</code> data-set has a new column <code>seed_day</code>, which counts the number of day elapsed from the sowing day. This is also returned in the output data.frame of <code>albufera_hb_local()</code>.</p></li>
<li><p><code>erahumed_ca</code> S3 class now inherits from <code>hb_local</code>.</p></li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-4-1">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-4-1"></a></h4>
<ul><li><p>Improvement in data.frame validity checks. The <code>assert_data.frame()</code> helper is now able to check column types. Noteworthy, this allows for much stricter tests in the <code>"hb_local"</code> and <code>"hb_global"</code> functions.</p></li>
<li><p>Important performance improvements in the function <code>ca()</code>. These were mainly achieved by (i) removing validity checks in the low level function <code>ca_to_cluster()</code>, supplanted by less costly checks at the level of the <code>hb_local()</code> output; and (ii) bypassing computation using <code>Date</code> objects, thanks to the introduced <code>seed_day</code> column in the output of <code>albufera_hb_local()</code> (see above).</p></li>
</ul></div>
<div class="section level4">
<h4 id="documentation-0-4-1">Documentation<a class="anchor" aria-label="anchor" href="#documentation-0-4-1"></a></h4>
<ul><li>Improved documentation of <code>albufera_hb_global()</code> default parameters.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.4.0" id="erahumed-040">erahumed 0.4.0<a class="anchor" aria-label="anchor" href="#erahumed-040"></a></h2>
<div class="section level4">
<h4 id="new-features-0-4-0">New features<a class="anchor" aria-label="anchor" href="#new-features-0-4-0"></a></h4>
<p>This version introduces a first draft for the new Chemicals Applications (CA) model block, which is meant to simulate the application of chemicals (fertilizers and pesticides), according to the previously obtained simulation of local water levels and water flows, which is the output of the hydrological balance (HB) block.</p>
<p>The basic <code>ca()</code> function is provided, which takes as input an object of S3 class <code>"hb_local"</code> (plus a few other optional input parameters), and returns a similar data-frame, with additional columns that provide the time series of chemical applications.</p>
<p>The accompanying dataset <code>albufera_ca_schedules</code> provides the schedules for chemical applications in the Albufera lake, and is one of the customizable inputs to <code>ca()</code>.</p>
</div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.3.2" id="erahumed-032">erahumed 0.3.2<a class="anchor" aria-label="anchor" href="#erahumed-032"></a></h2>
<div class="section level4">
<h4 id="under-the-hoods-0-3-2">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-3-2"></a></h4>
<ul><li><p>Shiny app continues to work if the Albufera Leaflet map cannot be loaded for any reason.</p></li>
<li><p>Added validation of date range to <code>albufera_hb_local()</code>.</p></li>
<li><p>Tested exceptions raised by <code>albufera_hb_local()</code>s argument validity checks.</p></li>
<li><p>Documented plotting method for <code>hb_local</code> and <code>hb_global</code> S3 objects.</p></li>
</ul></div>
<div class="section level4">
<h4 id="miscellaneous-0-3-2">Miscellaneous<a class="anchor" aria-label="anchor" href="#miscellaneous-0-3-2"></a></h4>
<ul><li>Added Pablo Amador and Andreu Rico to package <a href="mailto:Authors@R" class="email">Authors@R</a>.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.3.1" id="erahumed-031">erahumed 0.3.1<a class="anchor" aria-label="anchor" href="#erahumed-031"></a></h2>
<div class="section level4">
<h4 id="user-visible-changes-0-3-1">User visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-0-3-1"></a></h4>
<ul><li><p><code>albufera_hb_local()</code>, called with default arguments, now retrieves its value from disk, from data installed alongside with <a href="https://github.com/erahumed/erahumed" class="external-link">erahumed</a>.</p></li>
<li><p>Due to the previous point, the package’s .tar.gz file size is much larger now, approximately 50MB. The file size will be tackled, as much as possible, in later releases.</p></li>
<li><p>Added light <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> and <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> methods for the S3 objects returned by <code>albufera_hb_local()</code> and <code>albufera_hb_global()</code>.</p></li>
<li><p><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a> is no longer attached upon attaching <a href="https://github.com/erahumed/erahumed" class="external-link">erahumed</a>.</p></li>
</ul></div>
<div class="section level4">
<h4 id="bug-fixes-0-3-1">Bug fixes<a class="anchor" aria-label="anchor" href="#bug-fixes-0-3-1"></a></h4>
<ul><li>Package data is prefixed everywhere in the code by the <code>erahumed::</code> NAMESPACE, so that executing this code without having the package attached does not lead to errors. In particular, calling <code>erahumed::launch_app()</code> without attaching <a href="https://github.com/erahumed/erahumed" class="external-link">erahumed</a> does no longer lead to an error.</li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-3-1">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-3-1"></a></h4>
<ul><li>Fixed R-CMD-check spurious NOTEs.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.3.0" id="erahumed-030">erahumed 0.3.0<a class="anchor" aria-label="anchor" href="#erahumed-030"></a></h2>
<div class="section level4">
<h4 id="user-visible-changes-0-3-0">User visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-0-3-0"></a></h4>
<ul><li>New Shiny module to set parameters of the hydrological balance calculations.</li>
<li>New Shiny module to modify input data to the algorithms.</li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-3-0">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-3-0"></a></h4>
<ul><li>Added shinytest2 testing infrastructure, for snapshot based tests to be developed later.</li>
<li>Basic tests for plotting utilities (succeed with default arguments).</li>
<li>Server testing of <code>hb_shiny.R</code> modules, <a href="https://github.com/erahumed/erahumed/issues/15" class="external-link">#15</a>.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.2.2" id="erahumed-022">erahumed 0.2.2<a class="anchor" aria-label="anchor" href="#erahumed-022"></a></h2>
<div class="section level4">
<h4 id="user-visible-changes-0-2-2">User visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-0-2-2"></a></h4>
<ul><li><p>Documentation for the <code>albufera_hb_global()</code> and <code>albufera_hb_local()</code> wrappers.</p></li>
<li><p>Exported <code>hbg_residence_time()</code> doc page.</p></li>
<li><p>Former <code>albufera_weather</code> dataset becomes <code>albufera_petp</code>, and its structure is significantly simplified, now having only three columns: <code>date</code>, <code>rain_mm</code> and <code>evapotranspiration_mm</code> (previously named <code>date</code>, <code>P</code> and <code>ETP</code> respectively). All changes get propagated to downstream tables, such as <em>e.g.</em> <code>albufera_hb_global()</code>.</p></li>
</ul></div>
<div class="section level4">
<h4 id="algorithm-change-0-2-2">Algorithm change<a class="anchor" aria-label="anchor" href="#algorithm-change-0-2-2"></a></h4>
<ul><li>In previous versions of the algorithm, the plan delays upon failing to reach zero water levels on a given date were only being applied to the <code>ideal_height_cm</code> vector. In the present version, the draining and irrigation plan also get delayed. This has been observed to give rise to slightly more natural water profiles (in particular, the delay accumulated during summer is often less than 40 days, contrary to what used to happen with the previous version).</li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-2-2">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-2-2"></a></h4>
<ul><li>Add <code>"hb_local"</code> S3 class internal constructor (<a href="https://github.com/erahumed/erahumed/issues/21" class="external-link">#21</a>).</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.2.1" id="erahumed-021">erahumed 0.2.1<a class="anchor" aria-label="anchor" href="#erahumed-021"></a></h2>
<div class="section level4">
<h4 id="user-visible-changes-0-2-1">User visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-0-2-1"></a></h4>
<ul><li><p>Default arguments of <code>albufera_hb_global()</code> and <code>albufera_hb_local()</code> are now prepended with the <code>erahumed::</code> namespace specifier.</p></li>
<li><p>Unexported <code>residence_time()</code></p></li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-2-1">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-2-1"></a></h4>
<ul><li><p>Separated logical units of <code>hb_global()</code>, collected in <code>hb_global_units.R</code>.</p></li>
<li><p>Introduced argument checking for <code>hb_global()</code> and its wrapper <code>albufera_hb_global()</code>.</p></li>
<li><p>Introduced S3 class constructor for <code>"hb_global"</code> class objects (see <code>hb_global_units_s3_class.R</code>).</p></li>
<li><p>Important improvements in the testing infrastructure of <code>hb_global()</code> and<br><code>albufera_hb_global()</code>, both at the algorithmic level (through testing of <code>hb_global_units.R</code>) and at the level of exceptions raised by these two functions.</p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.2.0" id="erahumed-020">erahumed 0.2.0<a class="anchor" aria-label="anchor" href="#erahumed-020"></a></h2>
<div class="section level4">
<h4 id="user-visible-changes-0-2-0">User visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-0-2-0"></a></h4>
<ul><li><p>Reduced number of <code>*_is_imputed</code> entries in <code>hb_global</code> dataframes. Right now we are only providing <code>level_is_imputed</code> and <code>outflow_is_imputed</code>, which should suffice FAPP.</p></li>
<li><p>Big refactoring of the HB sector naming conventions. The wrappers become <code>albufera_hb_global/local()</code>, and the underlying functions are <code>hb_global/local()</code>.</p></li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-2-0">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-2-0"></a></h4>
<ul><li>We complete the work started with v0.1.2 to separate the algorithms for computing global and local hydrological balance, from the wrappers used to feed this algorithms with our prepared datasets. In this version, the wrappers got significantly simplified, their only function being extracting variables from the imported datasets and feeding them to the algorithms (as it should be).</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.1.2" id="erahumed-012">erahumed 0.1.2<a class="anchor" aria-label="anchor" href="#erahumed-012"></a></h2>
<div class="section level4">
<h4 id="user-visible-changes-0-1-2">User visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-0-1-2"></a></h4>
<ul><li>Improved appearance of cluster level plots in Shiny app UI.</li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-1-2">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-1-2"></a></h4>
<ul><li><p>Important code refactors for the local balance algorithm, aiming to separate the abstract logic of the algorithm from our specific conventions used to pack together data for hydrological balance - the latter conventions being relegated to <code>hb_wrappers.R</code> functions. Fixes <a href="https://github.com/erahumed/erahumed/issues/3" class="external-link">#3</a>.</p></li>
<li><p>Extensive unit testing of the logical units for the local balance algorithm.</p></li>
<li><p>Performance optimizations in local balance algorithm.</p></li>
<li><p>Sanity check functional tests for <code>plot.hb_local()</code> and <code>plot.hb_global()</code>.</p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.1.1" id="erahumed-011">erahumed 0.1.1<a class="anchor" aria-label="anchor" href="#erahumed-011"></a></h2>
<div class="section level4">
<h4 id="algorithm-0-1-1">Algorithm<a class="anchor" aria-label="anchor" href="#algorithm-0-1-1"></a></h4>
<ul><li>The main algorithm for local balance has been modified in such a way to ensure that the correct number of emptying events is always produced. This is achieved by delaying (by one day) the ideal water level plan whenever the ideal level is zero and the real level is above a certain threshold (2.5 mm by default). Moreover, outside of the sowing season, the water level plan is reset to the original one, in such a way that the Perellona does not get delayed.</li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-1-1">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-1-1"></a></h4>
<ul><li>Re-enabled continuous integration, with some internal code improvements.</li>
<li>Sanitizing of warnings/notes from R-cmd-check.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.1.0" id="erahumed-010">erahumed 0.1.0<a class="anchor" aria-label="anchor" href="#erahumed-010"></a></h2>
<div class="section level4">
<h4 id="algorithm-0-1-0">Algorithm<a class="anchor" aria-label="anchor" href="#algorithm-0-1-0"></a></h4>
<ul><li>Switched to an improved version of the algorithm to compute the local balance at the cluster level. The exactness of total outflows is enforced, in such a way that the sum of outflows of cluster that belong to a given ditch equals the total inflow to the Albufera lake from said ditch. Also, the logic of the algorithm was changed in such a way to enforce that no evaporation can occur when the water level of a cluster is zero. <strong>Warning.</strong> While correctly enforcing mass conservation, the present algorithm does not guarantee that the clusters will always be emptied for periods as long as planned, for the application of pesticides - both aspects being at odds with the previous version. Correctly enforcing the emptying of clusters will is the object of ongoing work.</li>
</ul></div>
<div class="section level4">
<h4 id="ui-0-1-0">UI<a class="anchor" aria-label="anchor" href="#ui-0-1-0"></a></h4>
<ul><li>The cluster to be plotted in the local balance tab of the shiny app can now be selected from an interactive leaflet map of the Albufera National Park.</li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-1-0">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-1-0"></a></h4>
<ul><li><p>Added internal utility <code>erahumed:::plot_albufera_clusters()</code> to obtain a leaflet map of clusters.</p></li>
<li><p>Added internal utility <code>erahumed:::plot_albufera_management()</code> to obtain a plot of ideal water levels vs. day of year.</p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.6" id="erahumed-006">erahumed 0.0.6<a class="anchor" aria-label="anchor" href="#erahumed-006"></a></h2>
<div class="section level4">
<h4 id="under-the-hoods-0-0-6">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-0-6"></a></h4>
<ul><li>Fixed an important bug that was causing real outflows to be zero in most cases.</li>
</ul></div>
<div class="section level4">
<h4 id="testing-0-0-6">Testing<a class="anchor" aria-label="anchor" href="#testing-0-0-6"></a></h4>
<ul><li>Added important functional tests for real outflows. In particular, we test that the sum of real outflows for clusters belonging to a given ditch is always equal to the minimum between the total ditch’s capacity and ideal required outflow.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.5" id="erahumed-005">erahumed 0.0.5<a class="anchor" aria-label="anchor" href="#erahumed-005"></a></h2>
<ul><li><p>The outputs of <code>albufera_hydro_balance_global()</code> and <code>albufera_hydro_balance_local()</code> get class attributes <code>"hb_global"</code> and <code>"hb_local"</code>, respectively.</p></li>
<li><p>Added cluster level plots to the shiny UI.</p></li>
</ul><div class="section level4">
<h4 id="under-the-hoods-0-0-5">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-0-5"></a></h4>
<ul><li>New plot methods for <code>"hb_global"</code> and <code>"hb_local"</code> S3 classes. Currently not exported to NAMESPACE.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.4" id="erahumed-004">erahumed 0.0.4<a class="anchor" aria-label="anchor" href="#erahumed-004"></a></h2>
<div class="section level4">
<h4 id="under-the-hoods-0-0-4">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-0-4"></a></h4>
<ul><li><p>Ordering of clusters sampled by the local hydrological balance simulation algorithm does not depend anymore on the way these clusters are sorted in the input data.</p></li>
<li><p>Fixed issues in the logic of local hydrological balance.</p></li>
<li><p>Improved testing infrastructure</p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.3" id="erahumed-003">erahumed 0.0.3<a class="anchor" aria-label="anchor" href="#erahumed-003"></a></h2>
<div class="section level4">
<h4 id="user-visible-changes-0-0-3">User-visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-0-0-3"></a></h4>
<ul><li><p>Big namespace refactor: all datasets get prepended with the prefix <code>"albufera_"</code>.</p></li>
<li><p>The functions <code>albufera_storage_curve()</code> and <code>petp_volume_change()</code> were substituted by the function <em>factories</em> <code>linear_storage_curve()</code> and <code>linear_petp_function()</code>, that create functions that perform affine transformations.</p></li>
<li><p>Function <code>albufera_hydro_balance()</code> was renamed <code>albufera_hydro_balance_global()</code>. Ditch inflows are not returned anymore. In correspondence, we add a new function <code>albufera_hydro_balance_local()</code>, which at the current moment is still WIP and for testing purposes.</p></li>
<li><p>Functions <code>albufera_hydro_balance_*()</code> now allow to specify storage curve and P-ETP surface by dedicated arguments. The defaults are defined throughout the new helpers mentioned in a previous point.</p></li>
<li><p>New function <code>hydro_balance_global()</code>, that is meant to capture the abstract part of the global hydrological balance calculations. The function <code>albufera_hydro_balance()</code> relies on this for its calculations of global balance.</p></li>
<li><p>Residence time is now computed in terms of the total outflow, rather than inflow as before. This reflects the way we handle cases of unaccounted outflow in <code>hydro_balance_global()</code> (set inflow to zero).</p></li>
</ul></div>
<div class="section level4">
<h4 id="documentation-0-0-3">Documentation<a class="anchor" aria-label="anchor" href="#documentation-0-0-3"></a></h4>
<ul><li>Improved documentation of the <code>hydro_balance_global()</code> function, as well as other minor improvements on documentation of helpers.</li>
</ul></div>
<div class="section level4">
<h4 id="under-the-hoods-0-0-3">Under the hoods<a class="anchor" aria-label="anchor" href="#under-the-hoods-0-0-3"></a></h4>
<ul><li>Started to work consistently on the testing infrastructure.</li>
</ul></div>
<div class="section level4">
<h4 id="notes-0-0-3">Notes<a class="anchor" aria-label="anchor" href="#notes-0-0-3"></a></h4>
<ul><li>Function names and the general API of these early versions of the package are understood to be provisional.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.2" id="erahumed-002">erahumed 0.0.2<a class="anchor" aria-label="anchor" href="#erahumed-002"></a></h2>
<ul><li><p>Added <code>clusters</code> and <code>cluster_geometries</code> datasets, containing information at the cluster (i.e. aggregate of rice paddies) level.</p></li>
<li><p>Separated computation of ditch inflow percents in a new function, <code>compute_ditch_inflow_pct()</code>, that leverages on the <code>clusters</code> dataset.</p></li>
<li><p>Corrected calculation of total outflow. In this calculation, the Perello daily outflow was being set to zero in the case of negative values. This does not make sense with the current computational approach.</p></li>
<li><p>Updated the <code>paddy_management</code> dataset: the irrigation and draining input binary vectors used previously were incomplete, with data until the middle of August. For this version, the inputs are defined until the 10th of September.</p></li>
</ul></div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.0.1" id="erahumed-001">erahumed 0.0.1<a class="anchor" aria-label="anchor" href="#erahumed-001"></a></h2>
<p>First release. Contains a draft of the utilities for hydrological balance data analysis, and a skeleton of the visualization app (currently invoked with <code>launch_app()</code>).</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Valerio Gherardi, Pablo Amador.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

