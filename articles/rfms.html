<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Designing custom agrochemical scenarios • erahumed</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Designing custom agrochemical scenarios">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">erahumed</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.21.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/erahumed-workflow.html">Simulation workflow</a></li>
    <li><a class="dropdown-item" href="../articles/rfms.html">Designing custom agrochemical scenarios</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/erahumed/erahumed/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Designing custom agrochemical scenarios</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/erahumed/erahumed/blob/v0.21.2/vignettes/rfms.Rmd" class="external-link"><code>vignettes/rfms.Rmd</code></a></small>
      <div class="d-none name"><code>rfms.Rmd</code></div>
    </div>

    
    
<p>This vignette is a practical guide to <strong>scenario
design</strong> in <a href="https://github.com/erahumed/erahumed" class="external-link">erahumed</a>, focused on two pillars:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Rice-Field Management Systems (RFMS)</strong> — the
agrochemical and hydrological management regimes applied to rice-field
clusters, and their spatial allocation via an
<code>rfms_map</code>.</p></li>
<li><p><strong>Custom chemicals</strong> — defining substances
(identity, fate/transport, sorption, toxicity) that can be referenced by
RFMS application schedules.</p></li>
</ol>
<p>A conceptual explanation of RFMS is provided in the <a href="https://erahumed.github.io/erahumed-book/chapters/rfms.html">user
manual</a>. Here we focus on <em>practical usage</em> within R.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/erahumed/erahumed" class="external-link">erahumed</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="built-in-definitions">Built-in definitions<a class="anchor" aria-label="anchor" href="#built-in-definitions"></a>
</h2>
<p>We begin by describing the built-in definitions of these objects, as
a way to illustrate the general concepts.</p>
<p>Starting with RFMSs, <a href="https://github.com/erahumed/erahumed" class="external-link">erahumed</a> comes with three
predefined management systems - <em>Bomba</em>, <em>Clearfield</em> and
<em>J.Sendra</em> - whose definitions are given by the helper functions
<code><a href="../reference/rfms.html">bomba()</a></code>, <code><a href="../reference/rfms.html">clearfield()</a></code>, and
<code><a href="../reference/rfms.html">jsendra()</a></code>. For instance:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rfms.html">clearfield</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;Rice Field Management System&gt;</span></span>
<span><span class="co">#&gt;   Name               :  Clearfield </span></span>
<span><span class="co">#&gt;   Sowing period     : Day 111 to 251 </span></span>
<span><span class="co">#&gt;   Perelloná period  : Day 306 to 15 </span></span>
<span><span class="co">#&gt;   Flow height       : 10 cm during sowing season</span></span>
<span><span class="co">#&gt;   Perelloná height  : 20 cm during Perelloná</span></span>
<span><span class="co">#&gt;   Applications      : 7 chemical application(s)</span></span></code></pre></div>
<p>To get a slightly more detailed view of this object, we can use the
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> method, which also prints the list of scheduled
chemical applications for this RFMS:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="../reference/rfms.html">clearfield</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;Rice Field Management System&gt;</span></span>
<span><span class="co">#&gt;   Name               :  Clearfield </span></span>
<span><span class="co">#&gt;   Sowing period     : Day 111 to 251 </span></span>
<span><span class="co">#&gt;   Perelloná period  : Day 306 to 15 </span></span>
<span><span class="co">#&gt;   Flow height       : 10 cm during sowing season</span></span>
<span><span class="co">#&gt;   Perelloná height  : 20 cm during Perelloná</span></span>
<span><span class="co">#&gt;   Applications      : 7 chemical application(s)</span></span>
<span><span class="co">#&gt;        chemical   type seed_day amount_kg_ha emptying_days</span></span>
<span><span class="co">#&gt;     Acetamiprid ground       52         0.03             6</span></span>
<span><span class="co">#&gt;      Cycloxydim ground       18         0.30             2</span></span>
<span><span class="co">#&gt;      Cycloxydim ground       52         0.30             6</span></span>
<span><span class="co">#&gt;    Azoxystrobin aerial       76         0.20            NA</span></span>
<span><span class="co">#&gt;    Azoxystrobin aerial       90         0.20            NA</span></span>
<span><span class="co">#&gt;  Difenoconazole aerial       76         0.13            NA</span></span>
<span><span class="co">#&gt;  Difenoconazole aerial       90         0.13            NA</span></span></code></pre></div>
<p>The way in which RFMSs are distributed across rice-field clusters is
encoded in the <em>RFMS map</em>. The default map applied by
<a href="https://github.com/erahumed/erahumed" class="external-link">erahumed</a> can be recovered through:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rfms_map.html">default_rfms_map</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;Rice-Field Management System Map&gt;</span></span>
<span><span class="co">#&gt;   Clusters         : 552 </span></span>
<span><span class="co">#&gt;   Management systems   : 2</span></span></code></pre></div>
<p>To delve under the hoods of this map, we can again use
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="../reference/rfms_map.html">default_rfms_map</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;Rice-Field Management System Map Summary&gt;</span></span>
<span><span class="co">#&gt;   Total clusters        : 552 </span></span>
<span><span class="co">#&gt;   Management systems: 2 </span></span>
<span><span class="co">#&gt;         rfms_id assigned_clusters</span></span>
<span><span class="co">#&gt; 1   1: J.Sendra               288</span></span>
<span><span class="co">#&gt; 2 2: Clearfield               264</span></span></code></pre></div>
<p>As seen above, the built-in RFMS definitions rely on the definitions
of chemicals. The package includes the following predefined objects:
<code><a href="../reference/pesticides.html">acetamiprid()</a></code>, <code><a href="../reference/pesticides.html">azoxystrobin()</a></code>,
<code><a href="../reference/pesticides.html">bentazone()</a></code>, <code><a href="../reference/pesticides.html">cycloxydim()</a></code>,
<code><a href="../reference/pesticides.html">cyhalofop_butyl()</a></code>, <code><a href="../reference/pesticides.html">difenoconazole()</a></code>,
<code><a href="../reference/pesticides.html">mcpa()</a></code> and <code><a href="../reference/pesticides.html">penoxsulam()</a></code>. The properties of
these are inspected in the usual way, <em>e.g.</em>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pesticides.html">acetamiprid</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;erahumed_chemical&gt;</span></span>
<span><span class="co">#&gt; Name:        Acetamiprid </span></span>
<span><span class="co">#&gt; TMoA ID:     NicotinicAcetylcholine </span></span>
<span><span class="co">#&gt; MW:          222.677 g/mol</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Physico-chemical properties:</span></span>
<span><span class="co">#&gt;   Solubility:      2950.00 ppm</span></span>
<span><span class="co">#&gt;   Koc:             200.00 cm³/g</span></span>
<span><span class="co">#&gt;   Film thickness:  0.200 cm</span></span>
<span><span class="co">#&gt; Degradation rates:</span></span>
<span><span class="co">#&gt;   kf (foliage):           0.1100 1/day</span></span>
<span><span class="co">#&gt;   kw (water column):         0.0154 1/day @ 20.0³C (Q10 = 2.58)</span></span>
<span><span class="co">#&gt;   ks (saturated sediment):   0.0420 1/day @ 20.0³C (Q10 = 2.58)</span></span>
<span><span class="co">#&gt;   ks (unsaturated sediment): 0.0290 1/day @ 20.0³C (Q10 = 2.58)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Toxicity (SSD, log₁₀ scale):</span></span>
<span><span class="co">#&gt;   Acute   mean ± sd: 2.44 ± 1.57</span></span>
<span><span class="co">#&gt;   Chronic mean ± sd: 1.99 ± 1.58</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-custom-chemicals">Creating custom chemicals<a class="anchor" aria-label="anchor" href="#creating-custom-chemicals"></a>
</h2>
<p>New chemicals can be created with the <code><a href="../reference/chemical.html">chemical()</a></code>
function, for example:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/chemical.html">chemical</a></span><span class="op">(</span>display_name <span class="op">=</span> <span class="st">"X"</span>, tmoa_id <span class="op">=</span> <span class="st">"Y"</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;erahumed_chemical&gt;</span></span>
<span><span class="co">#&gt; Name:        X </span></span>
<span><span class="co">#&gt; TMoA ID:     Y </span></span>
<span><span class="co">#&gt; MW:          330 g/mol</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Physico-chemical properties:</span></span>
<span><span class="co">#&gt;   Solubility:      500.00 ppm</span></span>
<span><span class="co">#&gt;   Koc:             200.00 cm³/g</span></span>
<span><span class="co">#&gt;   Film thickness:  0.200 cm</span></span>
<span><span class="co">#&gt; Degradation rates:</span></span>
<span><span class="co">#&gt;   kf (foliage):           0.2000 1/day</span></span>
<span><span class="co">#&gt;   kw (water column):         0.0500 1/day @ 20.0³C (Q10 = 2.58)</span></span>
<span><span class="co">#&gt;   ks (saturated sediment):   0.0500 1/day @ 20.0³C (Q10 = 2.58)</span></span>
<span><span class="co">#&gt;   ks (unsaturated sediment): 0.0500 1/day @ 20.0³C (Q10 = 2.58)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Toxicity (SSD, log₁₀ scale):</span></span>
<span><span class="co">#&gt;   Acute   mean ± sd: 7.50 ± 2.50</span></span>
<span><span class="co">#&gt;   Chronic mean ± sd: 4.50 ± 2.50</span></span></code></pre></div>
<p>returns an object representing a new substance named “X” with Toxic
Mode of Action (TMoA) “Y”, filling any unspecified physico-chemical and
toxicity properties with placeholder values. To further customize the
properties of “X”, specify additional arguments in
<code><a href="../reference/chemical.html">chemical()</a></code>. For instance:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/chemical.html">chemical</a></span><span class="op">(</span>display_name <span class="op">=</span> <span class="st">"X"</span>, tmoa_id <span class="op">=</span> <span class="st">"Y"</span>, MW <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;erahumed_chemical&gt;</span></span>
<span><span class="co">#&gt; Name:        X </span></span>
<span><span class="co">#&gt; TMoA ID:     Y </span></span>
<span><span class="co">#&gt; MW:          100 g/mol</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Physico-chemical properties:</span></span>
<span><span class="co">#&gt;   Solubility:      500.00 ppm</span></span>
<span><span class="co">#&gt;   Koc:             200.00 cm³/g</span></span>
<span><span class="co">#&gt;   Film thickness:  0.200 cm</span></span>
<span><span class="co">#&gt; Degradation rates:</span></span>
<span><span class="co">#&gt;   kf (foliage):           0.2000 1/day</span></span>
<span><span class="co">#&gt;   kw (water column):         0.0500 1/day @ 20.0³C (Q10 = 2.58)</span></span>
<span><span class="co">#&gt;   ks (saturated sediment):   0.0500 1/day @ 20.0³C (Q10 = 2.58)</span></span>
<span><span class="co">#&gt;   ks (unsaturated sediment): 0.0500 1/day @ 20.0³C (Q10 = 2.58)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Toxicity (SSD, log₁₀ scale):</span></span>
<span><span class="co">#&gt;   Acute   mean ± sd: 7.50 ± 2.50</span></span>
<span><span class="co">#&gt;   Chronic mean ± sd: 4.50 ± 2.50</span></span></code></pre></div>
<p>sets the molecular weight of “X” to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mspace width="0.167em"></mspace><mtext mathvariant="normal">g</mtext><mo>⋅</mo><msup><mtext mathvariant="normal">mol</mtext><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">100\,\text{g}\cdot \text{mol}^{-1}</annotation></semantics></math>.For
a full list of available chemical parameters, see <code><a href="../reference/chemical.html">?chemical</a></code>
or the relevant sections in the user manual (for example, <a href="https://erahumed.github.io/erahumed-book/chapters/rfms.html#sec-chemicals">here</a>.</p>
<p>Note that to store the object in the current R session, you need to
assign it, for example:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chem_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chemical.html">chemical</a></span><span class="op">(</span>display_name <span class="op">=</span> <span class="st">"X"</span>, tmoa_id <span class="op">=</span> <span class="st">"Y"</span>, MW <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-custom-rfms">Creating custom RFMS<a class="anchor" aria-label="anchor" href="#creating-custom-rfms"></a>
</h2>
<p>The creation of custom RFMSs proceeds in two steps: initialization
with the <code><a href="../reference/rfms.html">new_rfms()</a></code> constructor, and application scheduling
with <code><a href="../reference/schedule_application.html">schedule_application()</a></code>.For example, to create a new
RFMS that schedules an application of our new compound “X”, we would
proceed as follows.</p>
<p>We first initialize the new RFMS, which we will call “Z”:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rfms_z</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rfms.html">new_rfms</a></span><span class="op">(</span>sowing_yday <span class="op">=</span> <span class="fl">120</span>, display_name <span class="op">=</span> <span class="st">"Z"</span><span class="op">)</span></span></code></pre></div>
<p>As the code above illustrates, at this point we can also set some
general properties of the RFMS, such as the start date of the sowing
season (day of year 120 corresponds to May 1 on a regular non-leap
year). The full list of customizable parameters can be found in
<code><a href="../reference/rfms.html">?new_rfms</a></code>.</p>
<p>Subsequently, we schedule chemical applications:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rfms_z</span> <span class="op">&lt;-</span> <span class="va">rfms_z</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/schedule_application.html">schedule_application</a></span><span class="op">(</span>chemical <span class="op">=</span> <span class="va">chem_x</span>, </span>
<span>                                         seed_day <span class="op">=</span> <span class="fl">30</span>,</span>
<span>                                         amount_kg_ha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                         type <span class="op">=</span> <span class="st">"ground"</span>, </span>
<span>                                         <span class="op">)</span></span></code></pre></div>
<p>Here, the <code>chemical</code> argument must be a valid chemical
object, such as the <code>chem_x</code> created above. This can also be
any built-in chemical definition, for example:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rfms_z</span> <span class="op">&lt;-</span> <span class="va">rfms_z</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/schedule_application.html">schedule_application</a></span><span class="op">(</span>chemical <span class="op">=</span> <span class="fu"><a href="../reference/pesticides.html">difenoconazole</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                                         seed_day <span class="op">=</span> <span class="fl">80</span>,</span>
<span>                                         amount_kg_ha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                                         type <span class="op">=</span> <span class="st">"aerial"</span>, </span>
<span>                                         <span class="op">)</span></span></code></pre></div>
<p>The day of year on which applications should <em>ideally</em> occur
is specified with the <code>seed_day</code> argument, counted from the
sowing day (<code>120</code> in our example, so chemical “X” is
scheduled for day of year <code>150</code>). The actual application days
are often delayed with respect to this ideal, in order to satisfy
hydrological constraints; this is described in detail in the <a href="https://erahumed.github.io/erahumed-book/chapters/exposure.html#mass-income-rates">user
manual</a>.</p>
<p>We can inspect our current definition of <code>rfms_z</code> as
follows:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">rfms_z</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;Rice Field Management System&gt;</span></span>
<span><span class="co">#&gt;   Name               :  Z </span></span>
<span><span class="co">#&gt;   Sowing period     : Day 120 to 251 </span></span>
<span><span class="co">#&gt;   Perelloná period  : Day 306 to 15 </span></span>
<span><span class="co">#&gt;   Flow height       : 10 cm during sowing season</span></span>
<span><span class="co">#&gt;   Perelloná height  : 20 cm during Perelloná</span></span>
<span><span class="co">#&gt;   Applications      : 2 chemical application(s)</span></span>
<span><span class="co">#&gt;        chemical   type seed_day amount_kg_ha emptying_days</span></span>
<span><span class="co">#&gt;               X ground       30          1.0             1</span></span>
<span><span class="co">#&gt;  Difenoconazole aerial       80          0.5            NA</span></span></code></pre></div>
<p>Note that RFMS definition is incremental: you first create an empty
RFMS object, then populate it by scheduling applications one at a time.
In fact, we can also use <code><a href="../reference/schedule_application.html">schedule_application()</a></code> to create a
modified version of the pre-defined RFMS. For instance:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clearfield_bis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rfms.html">clearfield</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/schedule_application.html">schedule_application</a></span><span class="op">(</span>chemical <span class="op">=</span> <span class="va">chem_x</span>,</span>
<span>                                                       seed_day <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                                                       amount_kg_ha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                                       type <span class="op">=</span> <span class="st">"ground"</span></span>
<span>                                                       <span class="op">)</span></span></code></pre></div>
<p>Creates a new version of the <em>Clearfield</em> system with an extra
application of chemical “X” on day 10.</p>
<p>A practical way to code the definition of custom RFMSs, using the R
piping syntax, is presented in the last section of this vignette.</p>
</div>
<div class="section level2">
<h2 id="creating-custom-rfms-map">Creating custom RFMS map<a class="anchor" aria-label="anchor" href="#creating-custom-rfms-map"></a>
</h2>
<p>The RFMS map defines how RFMSs are allocated across the rice-field
surface of the Albufera Natural Park. Its definition also proceeds in
two steps.</p>
<p>First, initialize the map by choosing a default RFMS, which can be
any valid RFMS object:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rfms_map.html">new_rfms_map</a></span><span class="op">(</span>default_rfms <span class="op">=</span> <span class="va">rfms_z</span><span class="op">)</span></span></code></pre></div>
<p>Then allocate portions of the surface to other RFMSs using
<code><a href="../reference/allocate_surface.html">allocate_surface()</a></code>, for example:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/allocate_surface.html">allocate_surface</a></span><span class="op">(</span>system <span class="op">=</span> <span class="fu"><a href="../reference/rfms.html">clearfield</a></span><span class="op">(</span><span class="op">)</span>, target_fraction <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span></code></pre></div>
<p>In this example, the resulting RFMS map will be 30% Clearfield and
70% our custom RFMS “Z”:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;Rice-Field Management System Map Summary&gt;</span></span>
<span><span class="co">#&gt;   Total clusters        : 552 </span></span>
<span><span class="co">#&gt;   Management systems: 2 </span></span>
<span><span class="co">#&gt;         rfms_id assigned_clusters</span></span>
<span><span class="co">#&gt; 1          1: Z               405</span></span>
<span><span class="co">#&gt; 2 2: Clearfield               147</span></span></code></pre></div>
<p>Allocation can also be targeted to specific types and locations of
rice fields; see <code><a href="../reference/allocate_surface.html">?allocate_surface</a></code> for details.</p>
</div>
<div class="section level2">
<h2 id="full-workflow">Full workflow<a class="anchor" aria-label="anchor" href="#full-workflow"></a>
</h2>
<p>We summarize here the full workflow for running a simulation with a
custom agrochemical management scenario.</p>
<p>Proceeding bottom-up, we begin by defining the substances to be
applied to rice fields:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chem_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chemical.html">chemical</a></span><span class="op">(</span>display_name <span class="op">=</span> <span class="st">"Chem 1"</span>, tmoa_id <span class="op">=</span> <span class="st">"TMoA 1"</span><span class="op">)</span></span>
<span><span class="va">chem_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chemical.html">chemical</a></span><span class="op">(</span>display_name <span class="op">=</span> <span class="st">"Chem 2"</span>, tmoa_id <span class="op">=</span> <span class="st">"TMoA 1"</span><span class="op">)</span></span>
<span><span class="va">chem_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chemical.html">chemical</a></span><span class="op">(</span>display_name <span class="op">=</span> <span class="st">"Chem 3"</span>, tmoa_id <span class="op">=</span> <span class="st">"TMoA 2"</span><span class="op">)</span></span></code></pre></div>
<p>(In a real study, you would also set specific physico-chemical and
toxicity properties for these chemicals. Here we just kept the defaults
for brevity.)</p>
<p>Once we have the full set of custom substances, we define our custom
RFMSs — either starting from scratch or by extending existing ones:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rfms_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rfms.html">new_rfms</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/schedule_application.html">schedule_application</a></span><span class="op">(</span><span class="va">chem_1</span>, seed_day <span class="op">=</span> <span class="fl">10</span>, amount_kg_ha <span class="op">=</span> <span class="fl">1</span>, type <span class="op">=</span> <span class="st">"ground"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/schedule_application.html">schedule_application</a></span><span class="op">(</span><span class="va">chem_2</span>, seed_day <span class="op">=</span> <span class="fl">20</span>, amount_kg_ha <span class="op">=</span> <span class="fl">2</span>, type <span class="op">=</span> <span class="st">"ground"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/schedule_application.html">schedule_application</a></span><span class="op">(</span><span class="va">chem_3</span>, seed_day <span class="op">=</span> <span class="fl">70</span>, amount_kg_ha <span class="op">=</span> <span class="fl">2</span>, type <span class="op">=</span> <span class="st">"aerial"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/schedule_application.html">schedule_application</a></span><span class="op">(</span><span class="fu"><a href="../reference/pesticides.html">difenoconazole</a></span><span class="op">(</span><span class="op">)</span>, seed_day <span class="op">=</span> <span class="fl">90</span>, amount_kg_ha <span class="op">=</span> <span class="fl">0.5</span>, type <span class="op">=</span> <span class="st">"aerial"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bomba_bis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rfms.html">bomba</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/schedule_application.html">schedule_application</a></span><span class="op">(</span><span class="va">chem_3</span>, seed_day <span class="op">=</span> <span class="fl">70</span>, amount_kg_ha <span class="op">=</span> <span class="fl">2</span>, type <span class="op">=</span> <span class="st">"aerial"</span><span class="op">)</span></span></code></pre></div>
<p>As shown above, using the R pipe <code>|&gt;</code> syntax is
convenient for defining RFMSs, thanks to their incremental nature.</p>
<p>Once the RFMSs are set up, we allocate them in a new RFMS map:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rfms_map.html">new_rfms_map</a></span><span class="op">(</span>default_rfms <span class="op">=</span> <span class="va">rfms_1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/allocate_surface.html">allocate_surface</a></span><span class="op">(</span><span class="va">bomba_bis</span>, target_fraction <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
<p>This completes our round of definitions.</p>
<p>The <code>map</code> object created above encodes all details
relevant to the agrochemical scenario of the simulation. We can now run
a simulation with this scenario by passing the <code>map</code> object
to the <code>rfms_map</code> argument of
<code><a href="../reference/erahumed_simulation.html">erahumed_simulation()</a></code>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/erahumed_simulation.html">erahumed_simulation</a></span><span class="op">(</span>rfms_map <span class="op">=</span> <span class="va">map</span><span class="op">)</span></span>
<span><span class="co">#&gt; Initializing inputs</span></span>
<span><span class="co">#&gt; Computing hydrology: lake</span></span>
<span><span class="co">#&gt; Computing hydrology: clusters</span></span>
<span><span class="co">#&gt; Computing hydrology: ditches</span></span>
<span><span class="co">#&gt; Computing exposure: clusters</span></span>
<span><span class="co">#&gt; Computing exposure: ditches</span></span>
<span><span class="co">#&gt; Computing exposure: lake</span></span>
<span><span class="co">#&gt; Computing risk: clusters</span></span>
<span><span class="co">#&gt; Computing risk: ditches</span></span>
<span><span class="co">#&gt; Computing risk: lake</span></span>
<span><span class="va">sim</span></span>
<span><span class="co">#&gt; &lt;ERAHUMED Simulation&gt;</span></span>
<span><span class="co">#&gt;   Date range             : 2020-01-01 to 2020-12-31 </span></span>
<span><span class="co">#&gt;   Simulation days        : 366 </span></span>
<span><span class="co">#&gt;   Clusters               : 552 </span></span>
<span><span class="co">#&gt;   Management systems     : 2 </span></span>
<span><span class="co">#&gt;   Chemicals simulated    : 10 </span></span>
<span><span class="co">#&gt;   Total applications     : 17</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Need help extracting simulation outputs? Check `?get_results`.</span></span></code></pre></div>
<p>From this point on, the analysis proceeds as usual. For more details,
see the <a href="https://erahumed.github.io/erahumed/articles/erahumed-workflow.html">main
package vignette</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Valerio Gherardi, Pablo Amador.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
