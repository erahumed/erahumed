<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>ERAHUMED modeling interface — erahumed_modeling_interface • erahumed</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="ERAHUMED modeling interface — erahumed_modeling_interface"><meta name="description" content='The programming interface of the {erahumed} package reflects the sequential
structure of the ERAHUMED modeling chain. Each step of the sequence is
referred across this documentation as a model "component" (or, sometimes,
informally as a modeling "layer"). This documentation page focuses on
describing the set of abstractions provided by {erahumed} to deal with
sequential modeling and model components.
The first abstraction is provided by erahumed_model objects. These
objects, technically implemented as S3 classes, are simple containers for
model components - that is, a erahumed_model is a list that stores a
sequence of model components. The way components of a model are populated is
described subsequently.
We define the following model components, whose technical implementation is
discussed extensively in the linked documentation pages:
inp: INPut data.
hba: Hydrological Balance of the Albufera lake.
hbp: Hydrological Balance of rice Paddy clusters.
ca: Chemical Applications.
The order of model components in the list above is the logical one. Each
component depends on the previous ones (referred to as "upstream"),
and is a dependency of the subsequent ones (referred to as "downstream").


Each of these components has associated:
A compute_*() function, that takes a erahumed_model as input and
returns a model with the desired component computed on top as output.
An extractor function of the form *() (the asterisk standing for the
actual component name), that extracts the desired component from a
erahumed_model.
An S3 class following the naming scheme erahumed_*, that inherits from
erahumed_model_component, with ad-hoc print and plot methods.
Components can be re-computed (that is, the input model to compute_*()) can
have a previous computation of the same components. In this case, in order to
avoid confusing results, any existing downstream dependency of the component
to be recomputed is erased from the output model, and must be recomputed if
required.


The example code below illustrates typical operations with model components,'><meta property="og:description" content='The programming interface of the {erahumed} package reflects the sequential
structure of the ERAHUMED modeling chain. Each step of the sequence is
referred across this documentation as a model "component" (or, sometimes,
informally as a modeling "layer"). This documentation page focuses on
describing the set of abstractions provided by {erahumed} to deal with
sequential modeling and model components.
The first abstraction is provided by erahumed_model objects. These
objects, technically implemented as S3 classes, are simple containers for
model components - that is, a erahumed_model is a list that stores a
sequence of model components. The way components of a model are populated is
described subsequently.
We define the following model components, whose technical implementation is
discussed extensively in the linked documentation pages:
inp: INPut data.
hba: Hydrological Balance of the Albufera lake.
hbp: Hydrological Balance of rice Paddy clusters.
ca: Chemical Applications.
The order of model components in the list above is the logical one. Each
component depends on the previous ones (referred to as "upstream"),
and is a dependency of the subsequent ones (referred to as "downstream").


Each of these components has associated:
A compute_*() function, that takes a erahumed_model as input and
returns a model with the desired component computed on top as output.
An extractor function of the form *() (the asterisk standing for the
actual component name), that extracts the desired component from a
erahumed_model.
An S3 class following the naming scheme erahumed_*, that inherits from
erahumed_model_component, with ad-hoc print and plot methods.
Components can be re-computed (that is, the input model to compute_*()) can
have a previous computation of the same components. In this case, in order to
avoid confusing results, any existing downstream dependency of the component
to be recomputed is erased from the output model, and must be recomputed if
required.


The example code below illustrates typical operations with model components,'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">erahumed</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/erahumed/erahumed/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>ERAHUMED modeling interface</h1>
      <small class="dont-index">Source: <a href="https://github.com/erahumed/erahumed/blob/master/R/meta--docs-modeling-interface.R" class="external-link"><code>R/meta--docs-modeling-interface.R</code></a></small>
      <div class="d-none name"><code>erahumed_modeling_interface.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The programming interface of the <code>{erahumed}</code> package reflects the sequential
structure of the ERAHUMED modeling chain. Each step of the sequence is
referred across this documentation as a model "component" (or, sometimes,
informally as a modeling "layer"). This documentation page focuses on
describing the set of abstractions provided by <code>{erahumed}</code> to deal with
sequential modeling and model components.</p>
<p>The first abstraction is provided by <a href="erahumed_model.html">erahumed_model</a> objects. These
objects, technically implemented as S3 classes, are simple containers for
model components - that is, a <code>erahumed_model</code> is a list that stores a
sequence of model components. The way components of a model are populated is
described subsequently.</p>
<p>We define the following model components, whose technical implementation is
discussed extensively in the linked documentation pages:</p><ul><li><p><a href="inp.html">inp</a>: INPut data.</p></li>
<li><p><a href="hba.html">hba</a>: Hydrological Balance of the Albufera lake.</p></li>
<li><p><a href="hbp.html">hbp</a>: Hydrological Balance of rice Paddy clusters.</p></li>
<li><p><a href="ca.html">ca</a>: Chemical Applications.
The order of model components in the list above is the logical one. Each
component depends on the previous ones (referred to as "upstream"),
and is a dependency of the subsequent ones (referred to as "downstream").</p></li>
</ul><p>Each of these components has associated:</p><ol><li><p>A <code>compute_*()</code> function, that takes a <a href="erahumed_model.html">erahumed_model</a> as input and
returns a model with the desired component computed on top as output.</p></li>
<li><p>An extractor function of the form <code>*()</code> (the asterisk standing for the
actual component name), that extracts the desired component from a
<a href="erahumed_model.html">erahumed_model</a>.</p></li>
<li><p>An S3 class following the naming scheme <code>erahumed_*</code>, that inherits from
<code>erahumed_model_component</code>, with ad-hoc <a href="https://rdrr.io/r/base/print.html" class="external-link">print</a> and <a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a> methods.
Components can be re-computed (that is, the input model to <code>compute_*()</code>) can
have a previous computation of the same components. In this case, in order to
avoid confusing results, any existing downstream dependency of the component
to be recomputed is erased from the output model, and must be recomputed if
required.</p></li>
</ol><p>The example code below illustrates typical operations with model components,</p>
    </div>


    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Valerio Gherardi</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">### Computation workflow</span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="erahumed_model.html">erahumed_model</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># Initialize a blank model</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op">|&gt;</span> <span class="fu"><a href="inp.html">compute_inp</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="hba.html">compute_hba</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># Compute INP and HBA components</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">m</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> An ERAHUMED model.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Calculated components:  inp, hba</span>
<span class="r-in"><span><span class="fu"><a href="inp.html">inp</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> An ERAHUMED INP model component.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Output columns: date, level, outflow_pujol, outflow_perellonet, outflow_perello, is_imputed_level, is_imputed_outflow, rain_mm, evapotranspiration_mm</span>
<span class="r-in"><span><span class="fu"><a href="hba.html">hba</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> An ERAHUMED HBA model component.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Output columns: level, rain_mm, evapotranspiration_mm, date, is_imputed_level, is_imputed_outflow, volume, volume_change, volume_change_petp, outflow_pujol, outflow_perellonet, outflow_perello, outflow_extra, outflow_total, inflow_total, residence_time_days</span>
<span class="r-in"><span><span class="fu"><a href="hbp.html">hbp</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>  <span class="co"># NULL because not yet computed</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op">|&gt;</span> <span class="fu"><a href="inp.html">compute_inp</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># Recompute INP layer</span></span></span>
<span class="r-in"><span><span class="fu"><a href="hba.html">hba</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>  <span class="co"># NULL because of previous line</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The code below results in an error, because the HBP component depends</span></span></span>
<span class="r-in"><span><span class="co"># on the HBA component, which is still NULL (see above).</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="hbp.html">compute_hbp</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### Extracting and plotting outputs</span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op">|&gt;</span> <span class="fu"><a href="inp.html">compute_inp</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="hba.html">compute_hba</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="component_output.html">component_output</a></span><span class="op">(</span><span class="fu"><a href="inp.html">inp</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># 'erahumed_model_component' method</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         date     level outflow_pujol outflow_perellonet outflow_perello</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 2005-12-20 0.3725000      5.739292           2.919471        2.785127</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 2005-12-21 0.3726458      5.901080           3.140746        2.919733</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 2005-12-22 0.3683833      3.877427           2.500297        2.075301</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 2005-12-23 0.3662375      5.410336           3.180986        2.763805</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 2005-12-24 0.3667417      1.055759           1.578490        1.226585</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 2005-12-25 0.3634917      6.922879           3.786494        3.249450</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   is_imputed_level is_imputed_outflow rain_mm evapotranspiration_mm</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1            FALSE               TRUE     8.2                  0.54</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2            FALSE               TRUE     0.2                  0.65</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3            FALSE               TRUE     0.2                  0.62</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4            FALSE               TRUE     0.2                  1.02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5            FALSE               TRUE     0.0                  0.59</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6            FALSE               TRUE     0.2                  0.86</span>
<span class="r-in"><span><span class="fu"><a href="component_output.html">component_output</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"hba"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># 'erahumed_model' method</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       level rain_mm evapotranspiration_mm       date is_imputed_level</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 0.3725000     8.2                  0.54 2005-12-20            FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.3726458     0.2                  0.65 2005-12-21            FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 0.3683833     0.2                  0.62 2005-12-22            FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 0.3662375     0.2                  1.02 2005-12-23            FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 0.3667417     0.0                  0.59 2005-12-24            FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 0.3634917     0.2                  0.86 2005-12-25            FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   is_imputed_outflow   volume volume_change volume_change_petp outflow_pujol</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1               TRUE 25558393      3450.081          893796837      5.739292</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2               TRUE 25561843   -100840.946          -28739481      5.901080</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3               TRUE 25461002    -50765.481          -26358651      3.877427</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4               TRUE 25410237     11927.424          -58103048      5.410336</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5               TRUE 25422164    -76887.525          -46822986      1.055759</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6               TRUE 25345277   -157323.705          -45405289      6.922879</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   outflow_perellonet outflow_perello outflow_extra outflow_total inflow_total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1           2.919471        2.785127      10333.39  10344.830869       0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           3.140746        2.919733          0.00     11.961558     343.4273</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           2.500297        2.075301          0.00      8.453025     312.9424</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4           3.180986        2.763805          0.00     11.355127     683.9822</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5           1.578490        1.226585          0.00      3.860835     544.9036</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6           3.786494        3.249450          0.00     13.958823     537.6621</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   residence_time_days</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1          0.04163975</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2          0.04258338</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3          0.04358226</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4          0.04463149</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5          0.04573047</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6          0.04687804</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Returns an interactive plotly plot, run manually.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="hba.html">hba</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>, variable <span class="op">=</span> <span class="st">"outflow_total"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Valerio Gherardi, Pablo Amador.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

